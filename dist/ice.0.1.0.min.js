/*
 ice V0.1.0
 @author:JOU<huzhen555@qq.com>
 License:MIT
*/
!function(e,t){"use strict";function n(e){return function(t,n){var r="[ice:"+(e?e+"-":"")+t+"] "+n;return new Error(r)}}function r(e){return null!==e?e instanceof Array?"array":typeof e:"null"}function o(e,t,n){var o,i=r(e),a=r(t),c=0;if("array"===i&&n===!0)for(;c<e.length&&(o=t(e[c],c,e),o!==!1);c++);else{if("object"!==i&&n===!0)throw E("target","第一个参数类型必须为array或object");for(c in e)if(o=t(e[c],c,e),o===!1)break}if("function"!==a)throw E("callback","第二个参数类型必须为function")}function i(e,t){if("array"===r(e)){for(var n=e.length;--n>=0;)if(e[n]===t)return!0;return!1}throw E("function inArray:array","第一个参数必须为数组")}function a(){var e,n=arguments[0],a=r(n),c=O.call(arguments,1);if("array"!==a&&"object"!==a&&"function"!==a)throw E(a,"合并父体类型需为Array、Object或Function");return o(c,function(c){e=r(c),"array"===a?"array"===e||"object"===e?o(c,function(e){i(n,e)||n.push(e)}):null!==e&&e!==t&&n.push(c):"object"!==a&&"function"!==a||"object"===e&&o(c,function(e,t){n[t]=e})}),n}function c(e,t){t=!!t;var n=/\./g,r=/\//g,o=".",i="/";return t?e.replace(r,o):e.replace(n,i)}function u(e,t){e.currentPath=t}function l(e){return e.currentPath||""}function s(e,t){var n,r=[].concat(e);if("/"===b.params.moduleSeparator)for(var o=0;o<r.length;)""!==r[o]?(t(r[o],r[o+1]||""),o+=2):o++;else Z.foreach(r,function(e){""!==e&&(n=e.split(b.params.moduleSeparator),t(n[0],n[1]))})}function f(){return setTimeout(1)+""}function p(e){function t(){u===i&&(u=a,r=arguments,Z.foreach(l,function(e){e.onFulfilled&&e.onFulfilled.apply(null,r)}))}function n(e){u===i&&(u=c,o=e,Z.foreach(l,function(e){e.onRejected&&e.onRejected(o)}))}if("function"!==Z.type(e))throw E("function Promise","构造函数需传入一个函数参数");var r,o,i=0,a=1,c=2,u=i,l=[];this._isThenable=function(e){var t=Z.type(e);if(e&&("object"===t||"function"===t)){var n=e.then;if("function"===Z.type(n))return!0}return!1},this.handle=function(e){u===i?l.push(e):u===a&&"function"===Z.type(e.onFulfilled)?e.onFulfilled.apply(null,r):u===c&&"function"===Z.type(e.onRejected)&&e.onRejected(o)},e(t,n)}function d(){}function h(){}function y(t,n,r,o,i,a){var c,s,f,p,d,h,g,m,v,w=":m",M=":v",E=X.title,x=[];if("string"===Z.type(t)?f=[{url:t,entity:n,title:r,isCache:o}]:(f=t,i=n,a=r),Z.foreach(f,function(e,t){c=Z.type(e.title),s=e.entity.getAttribute(y.aModule),h=s+"_"+e.url,g=b.params.urlRule,e.isCache===!0&&"function"!==c&&(p=ne.getRedirect(h))?(Z.html(e.entity,p),0===t&&"string"===Z.type(f[0].title)&&(X.title=f[0].title)):(g=Z.replaceAll(g||"",w,s),g=Z.replaceAll(g||"",M,e.url),m=g.indexOf("/"),g="false"!==e.entity.getAttribute(y.aBase)&&b.params.base.url.length>0?b.params.base.url+(0===m?k.call(g,1):g):0===m?g:"/"+g,te.get(g).done(function(n){try{n=JSON.parse(n),d=n[b.params.htmlKey]}catch(r){d=n}Z.html(e.entity,d),e.isCache===!0&&ne.addRedirect(h,d),"0"===t&&(f[0].title="string"===c?f[0].title:"function"===c?f[0].title(n[b.params.codeKey]||null)||null:null,"string"===Z.type(f[0].title)&&(X.title=f[0].title))})),v=l(e.entity),u(e.entity,e.url),x.push({url:v,moduleName:s,cache:e.isCache,title:E}),i===!0&&y.setModuleRecord(s,e.url,!0)}),i===!0){if(!y.history.entity.pushState)throw T("History API","浏览器不支持HTML5 History API");y.history.setState(y.history.signature,x,!0),a!==!0&&y.history.push(null,f[0].title,y.getFormatModuleRecord()),y.history.setState(e.location.pathname,null)}}function g(e,t){this.load={},this.waiting=[],this.load[e]=t}function m(e,t){this.waiting=[]}function v(e){}function b(e){if("object"!==Z.type(e))throw j("params","配置参数为参数对象");var n,r={base:{url:"",plugin:"",driver:"",lang:""},stateMark:re[0],redirectCache:!0,codeKey:"code",htmlKey:"html",moduleSeparator:"-",urlRule:":m/:v.html",header:{}};Z.isEmpty(e)||(e.base!==t&&(e.base.url!==t&&(n=Z.type(e.base.url),e.base.url="string"===n?e.base.url:"function"===n?e.base.url():"",e.base.url="/"===e.base.url.substr(-1,1)?e.base.url:e.base.url+"/"),e.base.plugin!==t&&(n=Z.type(e.base.plugin),e.base.plugin="string"===n?e.base.plugin:"function"===n?e.base.plugin():"",e.base.plugin="/"===e.base.plugin.substr(-1,1)?e.base.plugin:e.base.plugin+"/"),e.base.driver!==t&&(n=Z.type(e.base.driver),e.base.driver="string"===n?e.base.driver:"function"===n?e.base.driver():"",e.base.driver="/"===e.base.driver.substr(-1,1)?e.base.driver:e.base.driver+"/")),e.base!==t&&e.base.lang!==t&&(n=Z.type(e.base.lang),e.base.lang="string"===n?e.base.lang:"function"===n?e.base.lang():"",e.base.lang="/"===e.base.lang.substr(-1,1)?e.base.lang:e.base.lang+"/"),e.stateMark=re.indexOf(e.stateMark)===-1?re[0]:e.stateMark,e.redirectCache=e.redirectCache!==!1),e.base=Z.extend(r.base,e.base),Z.extend(b,{params:Z.extend(r,e)})}function w(n,r){if(r===!0){if(n===t||null===n||1!==n.nodeType&&11!==n.nodeType)throw E("function control:node","control方法要求传入一个有效的node对象或DocumentFragment对象")}else r!==t||n!==t&&null!==n||(n=Z.s("body"));var o,i,a,c,l,f,p,d=[],h={};1===n.nodeType&&null!==n.getAttribute(y.aModule)&&d.push(n),d=d.concat(Z.S("*["+y.aModule+"]",n)),Z.foreach(d,function(e){return 1===e.nodeType&&void((o=e.getAttribute(y.aSrc))&&(i=e.getAttribute(y.aCache),o=y.getModuleRecord(e.getAttribute(y.aModule))||o,u(e,o),y(o,e,null,"true"===i||b.params.redirectCache===!0&&"false"!==i)))}),Z.foreach(O.call(Z.S("*["+y.aHref+"]")),function(e){"LINK"!==e.nodeName&&e.getAttribute(y.aTargetMod)&&ee.on(e,"click",y.click)}),ee.on(e,"popstate",function(t){a=y.history.getState(e.location.pathname),c={},l={},h={},f=[],"array"===Z.type(a)&&a.length>0?(1===a.length?N.call(f,{url:a[0].url,entity:Z.s("*["+y.aModule+"="+a[0].moduleName+"]"),title:a[0].title,isCache:a[0].cache}):Z.foreach(a,function(e){N.call(f,{url:e.url,entity:Z.s("*["+y.aModule+"="+e.moduleName+"]"),title:e.title,isCache:e.cache})}),y(f,!0,!0)):(s(P.call(y.history.signature,"/"),function(e,t){c[e]=t}),s(P.call(e.location.pathname,"/"),function(e,t){l[e]=t}),Z.foreach(l,function(e,t){c[t]!==e&&(h[t]=e)}),Z.foreach(c,function(e,t){l[t]!==e&&(h[t]=null)}),Z.foreach(h,function(e,t){p=Z.s("*["+y.aModule+"="+t+"]"),e=null===e?p.getAttribute(y.aSrc):e,y(e,p,b.params.header[e],"false"!==p.getAttribute(y.aCache)&&b.params.redirectCache,!0,!0)}))})}function M(e,t,n,r){var o,i,a=/^function\s*\((.*)\)\s*/,u=a.exec(n.toString())[1].split(","),l=r!==G?f():e.guid,s=0;Z.foreach(u,function(e,t,n){n[t]=Z.trim(e)}),t="array"===Z.type(t)?t.slice(0,u.length-1):t,o={type:r,deps:t,factory:n,args:u},r!==G?i=g.create(l,e,o):(i=g.loaders[l],i.putLoad(e.name,o)),Z.foreach(t,function(e){if(e=c(e),!ne.componentFactory(e,G)){i.putWaiting(e);var t=X.createElement("script");t.src=b.params.base.plugin+e+g.suffix+"?m="+e+"&guid="+l,t.setAttribute(g.moduleName,e),t.setAttribute(g.scriptFlag,""),t.setAttribute(g.loaderID,l),Z.appendScript(t,g.onScriptLoaded),s++}}),0===s&&e===g.topModuleName&&g.factoryInvoke(g.inject(o,i),r)}var T=n("env"),E=n("arg"),x=n("request"),j=n("config"),C=n("runtime"),S=n("module");if("undefined"==typeof e||"object"!=typeof e.document)throw T("browser","ice只能在浏览器环境中运行...");var L=[],A="",O=L.slice,R=L.splice,N=L.push,H=L.join,P=(L.concat,A.toUpperCase,A.toLowerCase,A.split),k=A.substr,F=A.replace,X=(Object.prototype.toString,Object.prototype.hasOwnProperty,Object.prototype.isPrototypeOf,e.document),I=e.ice||(e.ice={}),q=/^(?:TEXT|JSON|SCRIPT)$/,_={method:"GET",url:"",data:"",async:!0,cache:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",type:"TEXT"},D=(function(e){var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.* rv:([\w.]+)|)/.exec(e)||[],n=/(mac)/.exec(e)||/(windows)/.exec(e)||/(ipad)/.exec(e)||/(iphone)/.exec(e)||/(android)/.exec(e)||[],r={};return r[t[1]||""]=!0,r.version=t[2]||"0",r.platform=n[0]||"",r}(e.navigator.userAgent.toLowerCase()),["Microsoft.XMLHTTP","MSXML.XMLHTTP","Msxml2.XMLHTTP.7.0","Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.5.0","Msxml2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP"]),K=0,U=1,W=2,$=3,B=K,J=1,z=2,G=3,V=4,Q="BUILT_IN",Y="EXTERNAL",Z=a({},{extend:a,type:r,foreach:o,inArray:i,hasKey:function(e,t){if("object"===Z.type(e)){var n=!1;return Z.foreach(e,function(e,r){if(r===t)return n=e,!1}),n}throw E("function hasKey:object","检测对象必须为object类型")},isEmpty:function(e){var t=!0,n=Z.type(e);if("array"!==n&&"object"!==n)throw E("object","参数类型必须为array或object");return Z.foreach(e,function(){return t=!1,!1}),t},trim:function(e){if("string"!==Z.type(e))throw E("arg-type","参数类型必须为string");return e.replace(/(^\s*)|(\s*$)/g,"")},s:function(e,t){return(t||X).querySelector(e)},S:function(e,t){return O.call((t||X).querySelectorAll(e))},getAll:function(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return e.nodeName===t.toUpperCase()?O.call(n).concat([e]):O.call(n)},appendScript:function(e,t){var n=X.createElement("script");n.type="text/javascript",Z.foreach(e.attributes,function(e){2===e.nodeType&&n.setAttribute(e.nodeName,e.nodeValue)}),e.src?(n.async=!0,ee.on(n,"load readystatechange",function(e){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.raeadyState||t&&t(e),n.parentNode.removeChild(n)}),ee.on(n,"error",function(){n.parentNode.removeChild(n)}),X.head.appendChild(n)):e.text&&(n.text=e.text||"",X.head.appendChild(n).parentNode.removeChild(n))},scriptEval:function(e){var t=Z.type(e);if("string"===t){var n=X.createElement("script");n.type="text/javascript",n.text=e,Z.appendScript(n)}else if("object"===t&&1===e.nodeType&&"script"===e.nodeName.toLowerCase())Z.appendScript(e);else{if("array"!==t)throw E("arg","参数必须为javascript代码片段、script标签或script标签数组");var r=e.slice(0);Z.foreach(e,function(e){return R.call(r,0,1),e.src?(Z.appendScript(e,function(){r.length>0&&Z.scriptEval(r)}),!1):void Z.appendScript(e)})}},clear:function(e){if(1!==e.nodeType)throw E("context","元素类型必须是dom节点");return e.textContent="",e},append:function(e,t){var n,r,o,i=/<|&#?\w+;/,a=Z.type(t),c=0,u=[],l=[];if(1===e.nodeType){if("string"!==a||i.test(t))if("object"===a)t.nodeType&&u.push(t);else{for(n=X.createDocumentFragment(),r=n.appendChild(X.createElement("div")),r.innerHTML=t;c<r.childNodes.length;c++)u.push(r.childNodes[c]);r.textContent=""}else u.push(X.createTextNode(t));return n.textContent="",Z.foreach(u,function(t){if(e.appendChild(t),1===t.nodeType)for(r=Z.getAll(t,"script"),c=0;o=r[c++];)l.push(o)}),Z.isEmpty(l)||Z.scriptEval(l),e}throw E("context","context必须为DOM节点")},html:function(e,t){return e=Z.clear(e),e=Z.append(e,t)},replaceAll:function(e,t,n){if(3!==arguments.length)throw E("function:replaceAll","必须传入被替换字符串、查找替换的字符串和替换的字符串三个参数");if("string"!==Z.type(e)||"string"!==Z.type(t)||"string"!==Z.type(n))throw E("function:replaceAll","函数所有参数类型都必须为string");return t=t.split(""),Z.foreach(t,function(e,t,n){n[t]=["$","(",")","*","+",".","[","]","?","\\","^","{","}","|"].indexOf(e)!==-1?"\\"+e:e}),e.replace(new RegExp(t.join(""),"gm"),n)},isWindow:function(e){try{return"object"===Z.type(e)&&!!e.eval&&!!e.setInterval&&e.window===e.window.window}catch(t){return!1}}}),ee=function(){function e(e){u=this,l=n(u,e.type),"array"===Z.type(l)&&l.length>0&&Z.foreach(l,function(t){"function"===Z.type(t)&&t.call(u,e),t.once===!0&&r.remove(u,e.type,t,t.useCapture)})}function n(e,t,n,r){function u(e,t,n,r,o){if(i=Z.type(n),a=Z.type(r),"string"===i){if("function"===a){if(o){if(c=e[n].length>0){for(;--c>-1;)e[n][c]&&e[n][c].guid===r.guid&&R.call(e[n],c,1);0===e[n].length&&delete e[n]}}else e[n]||Object.defineProperty(e,n,{value:[],configurable:!0,enumerable:!0,writable:!0}),e[n].push(r);return e}return e[n]}return e}if(e){if(e.valueOf.override!==!0){if(!n||r)return t?[]:{};var l={};o=e.valueOf,Object.defineProperty(e,"valueOf",{value:function(){return arguments.length>0?u.apply(null,[l].concat(O.call(arguments))):o.call(e)}}),e.valueOf.override=!0}return e.valueOf(e,t,n,r)}return u(s,null,t,n,r)}var r,o,i,a,c,u,l,s={},p=/\S+/g,d={DOMContentLoaded:function(){return!!X.addEventListener}},h={load:"HTMLEvents",unload:"HTMLEvents",abort:"HTMLEvents",error:"HTMLEvents",select:"HTMLEvents",change:"HTMLEvents",submit:"HTMLEvents",reset:"HTMLEvents",focus:"HTMLEvents",blur:"HTMLEvents",resize:"HTMLEvents",scroll:"HTMLEvents",keypress:"KeyboartEvent",keyup:"KeyboartEvent",keydown:"KeyboartEvent",contextmenu:"MouseEvents",click:"MouseEvents",dbclick:"MouseEvents",mouseout:"MouseEvents",mouseover:"MouseEvents",mouseenter:"MouseEvents",mouseleave:"MouseEvents",mousemove:"MouseEvents",mousedown:"MouseEvents",mouseup:"MouseEvents",mousewheel:"MouseEvents"};return r={support:function(e,t){t=t||X.createElement("div");var n;return"function"===Z.type(d[e])?n=d[e]():(e="on"+e,n=e in t,!n&&t.setAttribute&&(t.setAttribute(e,""),n="function"===Z.type(t[e]))),n},on:function(o,i,a,c,u){if(Z.isWindow(o)||"object"===Z.type(o)&&o.nodeType||(u=c,c=a,a=i,i=o,o=t),o&&(3===o.nodeType||8===o.nodeType))throw E("function event.on:elem","elem参数不能为文本节点或注释节点");if("string"!==Z.type(i))throw E("function event.on:types","types参数类型必须为string");if("function"!==Z.type(a))throw E("function event.on:listener","listener参数类型必须为function");a.guid||(a.guid=f()),u===!0&&(a.once=!0,a.useCapture=c),F.call(i||"",p,function(t){n(o,t,a),o&&r.support(t,o)&&o.addEventListener&&o.addEventListener(t,e,!!c)})},remove:function(o,i,a,c){if(Z.isWindow(o)||"object"===Z.type(o)&&o.nodeType||(c=a,a=i,i=o,o=t),o.nodeType&&(3===o.nodeType||8===o.nodeType))throw E("function event.on:elem","elem参数不能为文本节点或注释节点");if("string"!==Z.type(i))throw E("function event.remove:types","types参数类型必须为string");if("function"!==Z.type(a))throw E("function event.remove:listener","listener参数类型必须为function");Z.isEmpty(n(o))||F.call(i||"",p,function(t){Z.isEmpty(n(o,t,a,!0))&&o&&r.support(t,o)&&o.removeEventListener&&o.removeEventListener(t,e,!!c)})},emit:function(n,r){if("string"===Z.type(n)&&(r=n,n=t),n&&(3===n.nodeType||8===n.nodeType))throw E("function event.emit:elem","elem参数不能为文本节点或注释节点");if("string"!==Z.type(r))throw E("function event.emit:types","types参数类型必须为string");F.call(r||"",p,function(t){if(ee.support(t,n)){var r=X.createEvent(h[t]||"CustomEvent");r.initEvent(t,!0,!1),X.dispatchEvent(r)}else e.call(n,{type:t})})}}}();p.prototype={constructor:p,then:function(e,t){var n=this;return new p(function(r,o){n.handle({onFulfilled:function(){var t="function"===Z.type(e)&&e.apply(null,arguments)||arguments;n._isThenable(t)&&t.then(function(){r()},function(e){o(e)})},onRejected:function(e){var n="function"===Z.type(t)&&t(e)||e;o(n)}})})},done:function(e){return this.handle({onFulfilled:e}),this},fail:function(e){return this.handle({onRejected:e}),this},always:function(e){this.handle({onFulfilled:e,onRejected:e})}},p.when=function(){};var te=Z.extend({},{request:function(t){return new p(function(n,r){var o,i,a,c=/%20/g,u=/#.*$/,l=/([?&])_=[^&]*/,s=/\?/,f=/^(?:GET|HEAD)$/;if(t.resolve=n,t.reject=r,t=Z.extend({},_,t||{}),t.hasContent=!f.test(t.method=t.method.toUpperCase()),t.type=q.test(t.type=(t.type||"").toUpperCase())?t.type:"TEXT","object"===Z.type(t.data)){var p=[];Z.foreach(t.data,function(e,t){p.push(t+"="+e)}),t.data=p.join("&")}if(t.hasContent?t.data&&"string"===Z.type(t.data)&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&(t.data=t.data.replace(c,"+")):(o=t.url.replace(u,""),i=t.url.slice(o.length),o+=t.data?(s.test(o)?"&":"?")+t.data:"",o=o.replace(l,""),o+=t.cache===!1?(s.test(o)?"&":"?")+"_="+Date.now():"",t.url=o+(i||"")),e.XMLHttpRequest)a=new XMLHttpRequest;else{if(!e.ActiveXObject)throw x("create","创建XHR失败");Z.foreach(D,function(t){try{a=new e.ActiveXObject(t)}catch(n){}})}a.open(t.method,t.url,t.async),t.hasContent&&t.data&&t.contentType&&a.setRequestHeader("Content-Type",t.contentType),a.onload=function(){if((a.status>=200&&a.status<300||304===a.status)&&t.resolve){var e,n={TEXT:function(){e=a.responseText},JSON:function(){try{e=JSON.parse(a.responseText)}catch(t){e=""}},SCRIPT:function(){e=a.responseText,Z.scriptEval(e)}};n[t.type](),t.success&&t.success(e)||t.resolve(e)}else t.reject&&(t.error&&t.error(a.responseText)||t.reject(a.responseText))},a.onerror=function(e){t.error&&t.error(e)||t.reject(e)},a.onabort=function(){};try{a.send(t.hasContent&&t.data||null)}catch(d){throw x("send",d)}})},get:function(e,n,r,o){"string"===Z.type(r)&&o===t&&(o=r,r=t),"function"===Z.type(n)?(r=n,n=t):q.test((n||"").toUpperCase())&&(o=n,n=t);var i={url:e};return i.args=n?n:t,i.success=r?r:t,i.type=o?o:t,te.request(i)},post:function(e,n,r,o){"string"===Z.type(r)&&o===t&&(o=r,r=t),"function"===Z.type(n)?(r=n,n=t):q.test((n||"").toUpperCase.call())&&(o=n,n=t);var i={url:e,method:"POST"};return i.data=n?n:t,i.success=r?r:t,i.type=o?o:t,te.request(i)}}),ne=function(){function e(e,t){Z.foreach(e,function(e,n){if(r[t].hasOwnProperty(n))throw S("plugin",n+"插件已存在");r[t][n]=e})}function n(e){Z.foreach(e,function(e,t){if(o.hasOwnProperty.call(t))throw S("driver",t+"元素驱动器已存在");o[t]=e})}var r={};r[Q]={},r[Y]={};var o={},i={},a={},c={page:null,module:[]};return{componentCreater:function(r,o,i){var a,c=Z.type(r);return"object"===c?(i=o,o=r,r=t):(a=o,o={},o[r]=a),i===Q||i===Y?e(o,i):i===V&&n(o),a||o},componentFactory:function(e,n){return n===G||n===t?r[Q][e]||r[Y][e]:n===V?o[e]:null},addRedirect:function(e,t){if(i.hasOwnProperty(e))throw S("module",e+"页面模块已存在");i[e]=t},getRedirect:function(e){return i[e]},addModule:function(e,t){if(a.hasOwnProperty(e))throw S("module",e+"模块已存在");a[e]=t},getModule:function(e){return a[e]},setPageFactory:function(e){"function"===Z.type(e)&&(c.page=e)},addUnexecutedModule:function(e){"function"===Z.type(e)&&N.call(c.module,e)},queueInvoke:function(){B===W&&"function"===Z.type(c.page)?c.page():B===$&&c.module.length>0&&Z.foreach(c.module,function(e){"function"===Z.type(e)&&e()})}}}();Z.extend(y,{aModule:"ice-module",aSrc:"ice-src",aCache:"ice-cache",aBase:"ice-base",aLoading:"ice-loading",aFinish:"ice-finish",aHref:"href",aAction:"action",aTargetMod:"ice-target-module"}),Z.extend(y,{history:{entity:e.history,replace:function(e,t,n){this.entity.replaceState(e,t,n)},push:function(e,t,n){this.entity.pushState(e,t,n)},getOriginalState:function(){return this.entity.state},state:{},signature:null,setState:function(e,t,n){this.state[e]=t,n===!0||(this.signature=e)},getState:function(e){return this.state[e]}},moduleRecord:{},setModuleRecord:function(e,t,n){if(y.moduleRecord[e]=t,n===!0){var r={};Z.foreach(y.moduleRecord,function(e,t){"object"===Z.type(Z.s("*[ice-module="+t+"]"))&&(r[t]=e)}),y.moduleRecord=r}},getModuleRecord:function(e){return y.moduleRecord[e]},getFormatModuleRecord:function(){var e=[];return Z.foreach(y.moduleRecord,function(t,n){N.call(e,n+(b.params.moduleSeparator||"")+t)}),"/"+H.call(e,"/")},click:function(e){var t=this.getAttribute(y.aTargetMod),n=this.getAttribute(y.aHref),r=this.getAttribute(y.aCache),o=Z.s("*["+y.aModule+"="+t+"]");if(e.preventDefault(),"object"!==Z.type(o))throw S("module","找不到"+t+"模块");l(o)===n||y(n,o,b.params.header[n],"true"===r||b.params.redirectCache===!0&&"false"!==r,!0)}});g.prototype={constructor:g,putWaiting:function(e){this.waiting.push(e)},dropWaiting:function(e){var t=this.waiting.indexOf(e);return t!==-1&&this.waiting.splice(t,1),this.waiting.length},putLoad:function(e,t){this.load[e]=t},getLoad:function(e){return this.load[e]}},g.suffix=".js",g.moduleName="data-moduleName",g.scriptFlag="module-loading",g.loaderID="loader-ID",g.topModuleName="*",g.loaders={},g.create=function(e,t,n){return g.loaders[e]=new g(t,n),g.loaders[e]},g.getCurrentModule=function(){try{____a.____b()}catch(e){if(e.stack){var t=/\?m=(\S+)&guid=([\d]+):?/.exec(e.stack);return{name:t[1],guid:t[2]}}}},g.inject=function(e,t){var n,r,o=[v];return Z.foreach(e.deps,function(e){(n=ne.componentFactory(e,G))?o.push(n):(n=g.inject(t.getLoad(e),t),ne.componentCreater(e,n,Y),o.push(n))}),e.type===J||e.type===z?r=function(){e.factory.apply(null,o)}:e.type===G?r=e.factory.apply(null,o):e.type===V,r},g.factoryInvoke=function(e,t){if(t===J)if(B===K)ne.setPageFactory(e);else{if(B!==W)throw C("error","页面状态错误(page)");e&&e(),B=$,ne.queueInvoke()}else if(t===z)if(B===W)ne.addUnexecutedModule(e);else{if(B!==$)throw C("error","页面状态错误(module)");e&&e()}},g.onScriptLoaded=function(e){var t=g.loaders[e.target.getAttribute(g.loaderID)];if(0===t.dropWaiting(e.target.getAttribute(g.moduleName))){var n=g.inject(t.getLoad(g.topModuleName),t);g.factoryInvoke(n,t.getLoad(g.topModuleName).type)}},ne.componentCreater({event:ee,Promise:p,animation:d,language:h,util:Z,http:te},Q),m.prototype={constructor:m},Z.extend(v,{refreshModule:function(e,t,n,r){"object"===Z.type(e)&&1===arguments.length}});var re=["@","$","^","*","|",":","~","!"];Z.extend(I,{config:b}),function(){var e;if(e=Z.s("script[config]").getAttribute("config")){var t=X.createElement("script");t.src=e,Z.appendScript(t,function(){B=U,ee.emit("parsed")})}else b({}),B=U}(),function(t){function n(){ee.remove(X,"DOMContentLoaded",n),ee.remove(e,"load",n),t()}"complete"===X.readyState?t():(ee.on(X,"DOMContentLoaded",n),ee.on(e,"load",n))}(function(){function t(){w(),B=W,ee.emit("page")}B===U?t():ee.on("parse",t,!1,!0),s(P.call(e.location.pathname,"/"),function(e,t){y.setModuleRecord(e,t)}),y.history.setState(e.location.pathname,null),B=W,ne.queueInvoke()}),Z.extend(I,{page:function(e,n){if(0===arguments.length)throw E("function ice.page","至少需要传入模块主函数参数");e&&!n&&(n=e,e=[]);var r=Z.type(e),o=Z.type(n);if(e!==t&&null!==e&&"array"!==r)throw E("function ice.page:dependence","方法第一个参数类型为Array，也可不传入第一个参数或传入null，方法将自动忽略此参数");if("function"!==o)throw E("function ice.page:factory","至少需要传入模块主函数参数，而不是其他类型参数");ee.on("page",function(){M(g.topModuleName,e,n,J)})},module:function(e,n){if(0===arguments.length)throw E("function ice.module","至少需要传入模块主函数参数");e&&!n&&(n=e,e=[]);var r=Z.type(e),o=Z.type(n);if(e!==t&&null!==e&&"array"!==r)throw E("function ice.module:dependence","方法第一个参数类型为Array，也可不传入第一个参数或传入null，方法将自动忽略此参数");if("function"!==o)throw E("function ice.module:factory","至少需要传入模块主函数参数，而不是其他类型参数");M(g.topModuleName,e,n,z)},control:function(e){return w(e,!0)}}),Z.extend(e,{plugin:function(e,n){if(0===arguments.length)throw E("function ice.plugin","至少需要传入模块主函数参数");e&&!n&&(n=e,e=[]);var r=Z.type(e),o=Z.type(n);if(e!==t&&null!==e&&"array"!==r)throw E("function ice.plugin:dependence","方法第一个参数类型为Array，也可不传入第一个参数或传入null，方法将自动忽略此参数");if("function"!==o)throw E("function ice.plugin:factory","至少需要传入模块主函数参数，而不是其他类型参数");M(g.getCurrentModule()||"",e,n,G)},driver:function(e,n){if(0===arguments.length)throw E("function ice.driver","至少需要传入模块主函数参数");e&&!n&&(n=e,e=[]);var r=Z.type(e),o=Z.type(n);if(e!==t&&null!==e&&"array"!==r)throw E("function ice.driver:dependence","方法第一个参数类型为Array，也可不传入第一个参数或传入null，方法将自动忽略此参数");if("function"!==o)throw E("function ice.driver:factory","至少需要传入模块主函数参数，而不是其他类型参数");M(g.topModuleName,e,n,V)}})}(window);