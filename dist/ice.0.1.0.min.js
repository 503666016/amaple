/*
 ice V0.1.0
 @author:JOU<huzhen555@qq.com>
 License:MIT
*/
!function(e,t){"use strict";function n(e){return function(t,n){var r="[ice:"+(e?e+"-":"")+t+"] "+n;return new Error(r)}}function r(e){return null!==e?e instanceof Array?"array":typeof e:"null"}function o(e,t,n){var o,a=r(e),i=r(t),u=0;if("array"===a&&n===!0)for(;u<e.length&&(o=t(e[u],u,e),o!==!1);u++);else{if("object"!==a&&n===!0)throw x("target","第一个参数类型必须为array或object");for(u in e)if(o=t(e[u],u,e),o===!1)break}if("function"!==i)throw x("callback","第二个参数类型必须为function")}function a(e,t){if("array"===r(e)){for(var n=e.length;--n>=0;)if(e[n]===t)return!0;return!1}throw x("function inArray:array","第一个参数必须为数组")}function i(){var e,n=arguments[0],i=r(n),u=H.call(arguments,1);if("array"!==i&&"object"!==i&&"function"!==i)throw x(i,"合并父体类型需为Array、Object或Function");return o(u,function(u){e=r(u),"array"===i?"array"===e||"object"===e?o(u,function(e){a(n,e)||n.push(e)}):null!==e&&e!==t&&n.push(u):"object"!==i&&"function"!==i||"object"===e&&o(u,function(e,t){n[t]=e})}),n}function u(e,t){t=!!t;var n=/\./g,r=/\//g,o=".",a="/";return t?e.replace(r,o):e.replace(n,a)}function c(e,t){e.currentPath=t}function s(e){return e.currentPath||""}function l(e,t){var n,r=[].concat(e);if("/"===w.params.moduleSeparator)for(var o=0;o<r.length;)""!==r[o]?(t(r[o],r[o+1]||""),o+=2):o++;else Q.foreach(r,function(e){""!==e&&(n=e.split(w.params.moduleSeparator),t(n[0],n[1]))})}function p(){return setTimeout(1)+""}function f(e){function t(){c===a&&(c=i,r=arguments,Q.foreach(s,function(e){e.onFulfilled&&e.onFulfilled.apply(null,r)}))}function n(e){c===a&&(c=u,o=e,Q.foreach(s,function(e){e.onRejected&&e.onRejected(o)}))}if("function"!==Q.type(e))throw x("function Promise","构造函数需传入一个函数参数");var r,o,a=0,i=1,u=2,c=a,s=[];this._isThenable=function(e){var t=Q.type(e);if(e&&("object"===t||"function"===t)){var n=e.then;if("function"===Q.type(n))return!0}return!1},this.handle=function(e){c===a?s.push(e):c===i&&"function"===Q.type(e.onFulfilled)?e.onFulfilled.apply(null,r):c===u&&"function"===Q.type(e.onRejected)&&e.onRejected(o)},e(t,n)}function d(){}function h(){}function y(n){var r,o,a,i,u,c,s,l,p,d,h,y,m,g=/^(.*?):[ \t]*([^\r\n]*)$/gm,v=/(\S+)=(\S+)&?/,b=/%20/g,w=/#.*$/,T=/([?&])_=[^&]*/,M=/\?/,E=/^(?:GET|HEAD)$/,x=/^(?:TEXT|JSON|SCRIPT)$/,j={"*":["*/"]+["*"],text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},A={method:"GET",url:"",data:"",async:!0,cache:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"TEXT",headers:{}},C=function(e){return function(n){return e?(r=n[0],o=n[1],a=n[2],i=n[3],"string"===Q.type(a)&&i===t&&(i=a,a=t),"function"===Q.type(o)?(a=o,o=t):x.test((o||"").toUpperCase())&&(i=o,o=t),h={url:r,args:o||t,success:a||t,dataType:i||t,method:e}):h=n[0],Q.extend({},A,h)}}(n),L={text:function(e){return e},json:function(e){return JSON.parse(e)},script:function(e){Q.scriptEval(e)},jsonp:function(){}},R={xhr:function(){return{send:function(e,t){var n,r=this,o=this.xhr=function(){try{return new XMLHttpRequest}catch(e){}}();o.open(e.method,e.url,e.async,e.username,e.password),e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),o.setRequestHeader("X-Requested-With","XMLHTTPRequest");for(n in this.headers)o.setRequestHeader(n,this.headers[n]);"function"===Q.type(e.abort)&&Y.support("abort",o)&&(o.onabort=function(){e.abort(t.statusText)}),Y.support("error",o)?o.onload=o.onerror=function(e){c=!0,r.status="load"===e.type?200:500,r.done(t)}:o.onreadystatechange=function(){o.readyState===XMLHttpRequest.DONE&&(c=!0,r.status=o.status>=200&&o.status<300||304===o.status||1223===o.status?200:500,r.done(t))};try{o.send(e.hasContent&&e.data||null)}catch(a){throw S("send",a)}},done:function(t){var n=this.xhr;if(n&&(n.onload=n.onerror=n.onreadystatechange=null,this.type&&"function"===Q.type(n.abort)&&(s=0,l=this.type,n.abort()),c)){this.timeoutID&&e.clearTimeout(this.timeoutID),this.responseHeadersString=n.getAllResponseHeaders(),s=n.status,l=n.statusText;try{d=L[i](n.responseText)}catch(r){s=this.status=500,l="Parse Error: "+r}200===this.status?this.callbacks.success&&this.callbacks.success(d,l,t):500===this.status&&this.callbacks.error&&this.callbacks.error(t,l),this.callbacks.complete&&this.callbacks.complete(t,l),delete t.transport,delete this.status}}}},jsonp:function(){return{send:function(){},done:function(){}}},script:function(){return{send:function(){},done:function(){}}},submit:function(){return{send:function(){},done:function(){}}}},H={transport:null,setRequestHeader:function(e,t){c||(this.transport.headers=this.transport.headers||{},this.transport.headers[e.toLowerCase()]=t)},getResponseHeader:function(e){var t;if(c){if(!this.transport.respohseHeader)for(this.transport.respohseHeader={};t=g.exec(this.transport.responseHeadersString||"");)this.transport.respohseHeader[t[1].toLowerCase()]=t[2];t=this.transport.responseHeader[e]}return t||null},getAllResponseHeaders:function(){return c?this.transport.responseHeadersString:null},overrideMimeType:function(e){c||(u.mimetype=e)},abort:function(e){this.transport&&(this.transport.type=e||"abort",this.transport.done())},addEventListener:function(e,t){c||(this.transport.callbacks=this.transport.callbacks||{},this.transport.callbacks[e]=t)}};return function(){if(c=!1,s=0,l="",u=C(arguments),u.hasContent=!E.test(u.method=u.method.toUpperCase()),u.dataType=x.test(u.dataType=(u.dataType||"").toUpperCase())?u.dataType:"TEXT",u.timeout=u.timeout>0?u.timeout:0,"object"===Q.type(u.data)){var e=[];Q.foreach(u.data,function(t,n){e.push(n+"="+t)}),u.data=e.join("&")}return u.hasContent?u.data&&"string"===Q.type(u.data)&&0===(u.contentType||"").indexOf("application/x-www-form-urlencoded")&&(u.data=u.data.replace(b,"+")):(y=u.url.replace(w,""),m=u.url.slice(y.length),y+=u.data?(M.test(y)?"&":"?")+u.data:"",y=y.replace(T,""),y+=u.cache===!1?(M.test(y)?"&":"?")+"_="+Date.now():"",u.url=y+(m||"")),new f(function(e,t){i=u.dataType.toLowerCase(),p=""!==u.data&&"string"===Q.type(u.data)&&!v.test(u.data)||u.data instanceof FormData?"submit":i,H.transport=R[p]?R[p]():R.xhr(),u.contentType&&H.setRequestHeader("Content-Type",u.contentType),H.setRequestHeader("Accept",j[i]?j[i]+", */*; q=0.01":j["*"]);for(var n in u.headers)H.setRequestHeader(n,u.headers[n]);"function"===Q.type(u.beforeSend)&&u.beforeSend(H,u),"complete success error".replace(/\S+/g,function(n){u[n]="success"===n?e:u[n],u[n]="error"===n?t:u[n],H.addEventListener(n,u[n])}),u.async&&u.timeout>0&&(H.transport.timeoutID=setTimeout(function(){H.abort("timeout")},u.timeout)),H.transport.send(u,H)})}}function m(n,o,a,i,u,l,p,f,d,h,y,g){var v,b,T,M,x,S,j,A,C,L,R,H=Q.type(i),O=":m",k=":v",N=P.title,F=[];if(x="string"===Q.type(n)?[{url:n,entity:o,data:a}]:n,Q.foreach(x,function(e,n){v=e.entity.getAttribute(m.aModule),A=v+"_"+e.url,C=w.params.urlRule,b=e.entity.getAttribute(m.aCache),T="true"===b||w.params.redirectCache===!0&&"false"!==b,M="false"!==e.entity.getAttribute(m.aBase)&&w.params.base.url.length>0,e.isCache===!0&&"function"!==r&&(S=ee.getRedirect(A))?(Q.html(e.entity,S),"string"===H&&i.length>0&&(P.title=i)):(C=Q.replaceAll(C||"",O,v),C=Q.replaceAll(C||"",k,e.url),L=C.indexOf("/"),C=M?w.params.base.url+(0===L?q.call(C,1):C):0===L?C:"/"+C,Z.request({url:C,data:e.data||"",method:/^(GET|POST)$/i.test(u)?u.toUpperCase():"GET",timeout:l||0,beforeSend:function(){"function"===Q.type(p)&&p(e)},abort:function(){"function"===Q.type(h)&&h(e)}}).done(function(t){try{t=JSON.parse(t),j=t[w.params.htmlKey]}catch(n){j=t}Q.html(e.entity,j),e.isCache===!0&&ee.addRedirect(A,j),i="string"===H?i:"function"===H?i(t[w.params.codeKey]||null)||null:null,"string"===Q.type(i)&&i.length>0&&(P.title=i),"function"===Q.type(f)&&f(e)}).fail(function(e){"function"===Q.type(e)&&e(o,e)})),R=s(e.entity),c(e.entity,e.url),F.push({url:R,moduleName:v,data:e.data,title:"0"===n?N:t}),y===!0&&m.setModuleRecord(v,e.url,!0)}),y===!0){if(!m.history.entity.pushState)throw E("History API","浏览器不支持HTML5 History API");m.history.setState(m.history.signature,F,!0),g!==!0&&m.history.push(null,x[0].title,m.getFormatModuleRecord()),m.history.setState(e.location.pathname,null)}}function g(e,t){this.load={},this.waiting=[],this.load[e]=t}function v(e,t){this.waiting=[]}function b(e){}function w(e){if("object"!==Q.type(e))throw j("params","配置参数为参数对象");var n,r={base:{url:"",plugin:"",driver:"",lang:""},stateMark:te[0],redirectCache:!0,codeKey:"code",htmlKey:"html",moduleSeparator:"-",urlRule:":m/:v.html",header:{}};Q.isEmpty(e)||(e.base!==t&&(e.base.url!==t&&(n=Q.type(e.base.url),e.base.url="string"===n?e.base.url:"function"===n?e.base.url():"",e.base.url="/"===e.base.url.substr(-1,1)?e.base.url:e.base.url+"/"),e.base.plugin!==t&&(n=Q.type(e.base.plugin),e.base.plugin="string"===n?e.base.plugin:"function"===n?e.base.plugin():"",e.base.plugin="/"===e.base.plugin.substr(-1,1)?e.base.plugin:e.base.plugin+"/"),e.base.driver!==t&&(n=Q.type(e.base.driver),e.base.driver="string"===n?e.base.driver:"function"===n?e.base.driver():"",e.base.driver="/"===e.base.driver.substr(-1,1)?e.base.driver:e.base.driver+"/")),e.base!==t&&e.base.lang!==t&&(n=Q.type(e.base.lang),e.base.lang="string"===n?e.base.lang:"function"===n?e.base.lang():"",e.base.lang="/"===e.base.lang.substr(-1,1)?e.base.lang:e.base.lang+"/"),e.stateMark=te.indexOf(e.stateMark)===-1?te[0]:e.stateMark,e.redirectCache=e.redirectCache!==!1),e.base=Q.extend(r.base,e.base),Q.extend(w,{params:Q.extend(r,e)})}function T(n,r){if(r===!0){if(n===t||null===n||1!==n.nodeType&&11!==n.nodeType)throw x("function control:node","control方法要求传入一个有效的node对象或DocumentFragment对象")}else r!==t||n!==t&&null!==n||(n=Q.s("body"));var o,a,i,u,s,p,f,d=[],h={};1===n.nodeType&&null!==n.getAttribute(m.aModule)&&d.push(n),d=d.concat(Q.S("*["+m.aModule+"]",n)),Q.foreach(d,function(e){return 1===e.nodeType&&void((o=e.getAttribute(m.aSrc))&&(a=e.getAttribute(m.aCache),o=m.getModuleRecord(e.getAttribute(m.aModule))||o,c(e,o),m(o,e)))}),Q.foreach(H.call(Q.S("*["+m.aHref+"]")),function(e){"LINK"!==e.nodeName&&e.getAttribute(m.aTargetMod)&&Y.on(e,"click",m.click)}),Y.on(e,"popstate",function(t){i=m.history.getState(e.location.pathname),u={},s={},h={},p=[],"array"===Q.type(i)&&i.length>0?(Q.foreach(i,function(e){p.push({url:e.url,entity:Q.s("*["+m.aModule+"="+e.moduleName+"]"),data:e.data})}),m(p,null,null,i[0].title,null,null,null,null,null,null,!0,!0)):(l(F.call(m.history.signature,"/"),function(e,t){u[e]=t}),l(F.call(e.location.pathname,"/"),function(e,t){s[e]=t}),Q.foreach(s,function(e,t){u[t]!==e&&(h[t]=e)}),Q.foreach(u,function(e,t){s[t]!==e&&(h[t]=null)}),Q.foreach(h,function(e,t){f=Q.s("*["+m.aModule+"="+t+"]"),e=null===e?f.getAttribute(m.aSrc):e,p.push({url:e,entity:f,data:null})}),m(p,null,null,w.params.header[p[0].url],null,null,null,null,null,null,!0,!0))})}function M(e,t,n,r){var o,a,i=/^function\s*\((.*)\)\s*/,c=i.exec(n.toString())[1].split(","),s=r!==G?p():e.guid,l=0;Q.foreach(c,function(e,t,n){n[t]=Q.trim(e)}),t="array"===Q.type(t)?t.slice(0,c.length-1):t,o={type:r,deps:t,factory:n,args:c},r!==G?a=g.create(s,e,o):(a=g.loaders[s],a.putLoad(e.name,o)),Q.foreach(t,function(e){if(e=u(e),!ee.componentFactory(e,G)){a.putWaiting(e);var t=P.createElement("script");t.src=w.params.base.plugin+e+g.suffix+"?m="+e+"&guid="+s,t.setAttribute(g.moduleName,e),t.setAttribute(g.scriptFlag,""),t.setAttribute(g.loaderID,s),Q.appendScript(t,g.onScriptLoaded),l++}}),0===l&&e===g.topModuleName&&g.factoryInvoke(g.inject(o,a),r)}var E=n("env"),x=n("arg"),S=n("request"),j=n("config"),A=n("runtime"),C=n("module");if("undefined"==typeof e||"object"!=typeof e.document)throw E("browser","ice只能在浏览器环境中运行...");var L=[],R="",H=L.slice,O=L.splice,k=L.push,N=L.join,F=(L.concat,R.toUpperCase,R.toLowerCase,R.split),q=R.substr,I=R.replace,P=(Object.prototype.toString,Object.prototype.hasOwnProperty,Object.prototype.isPrototypeOf,e.document),D=e.ice||(e.ice={}),_=(function(e){var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.* rv:([\w.]+)|)/.exec(e)||[],n=/(mac)/.exec(e)||/(windows)/.exec(e)||/(ipad)/.exec(e)||/(iphone)/.exec(e)||/(android)/.exec(e)||[],r={};return r[t[1]||""]=!0,r.version=t[2]||"0",r.platform=n[0]||"",r}(e.navigator.userAgent.toLowerCase()),0),K=1,U=2,W=3,X=_,$=1,B=2,G=3,J=4,z="BUILT_IN",V="EXTERNAL",Q=i({},{extend:i,type:r,foreach:o,inArray:a,hasKey:function(e,t){if("object"===Q.type(e)){var n=!1;return Q.foreach(e,function(e,r){if(r===t)return n=e,!1}),n}throw x("function hasKey:object","检测对象必须为object类型")},isEmpty:function(e){var t=!0,n=Q.type(e);if("array"!==n&&"object"!==n)throw x("object","参数类型必须为array或object");return Q.foreach(e,function(){return t=!1,!1}),t},trim:function(e){if("string"!==Q.type(e))throw x("arg-type","参数类型必须为string");return e.replace(/(^\s*)|(\s*$)/g,"")},s:function(e,t){return(t||P).querySelector(e)},S:function(e,t){return H.call((t||P).querySelectorAll(e))},getAll:function(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return e.nodeName===t.toUpperCase()?H.call(n).concat([e]):H.call(n)},appendScript:function(e,t){var n=P.createElement("script");n.type="text/javascript",Q.foreach(e.attributes,function(e){2===e.nodeType&&n.setAttribute(e.nodeName,e.nodeValue)}),e.src?(n.async=!0,Y.on(n,"load readystatechange",function(e){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.raeadyState||t&&t(e),n.parentNode.removeChild(n)}),Y.on(n,"error",function(){n.parentNode.removeChild(n)}),P.head.appendChild(n)):e.text&&(n.text=e.text||"",P.head.appendChild(n).parentNode.removeChild(n))},scriptEval:function(e){var t=Q.type(e);if("string"===t){var n=P.createElement("script");n.type="text/javascript",n.text=e,Q.appendScript(n)}else if("object"===t&&1===e.nodeType&&"script"===e.nodeName.toLowerCase())Q.appendScript(e);else{if("array"!==t)throw x("arg","参数必须为javascript代码片段、script标签或script标签数组");var r=e.slice(0);Q.foreach(e,function(e){return O.call(r,0,1),e.src?(Q.appendScript(e,function(){r.length>0&&Q.scriptEval(r)}),!1):void Q.appendScript(e)})}},clear:function(e){if(1!==e.nodeType)throw x("context","元素类型必须是dom节点");return e.textContent="",e},append:function(e,t){var n,r,o,a=/<|&#?\w+;/,i=Q.type(t),u=0,c=[],s=[];if(1===e.nodeType){if("string"!==i||a.test(t))if("object"===i)t.nodeType&&c.push(t);else{for(n=P.createDocumentFragment(),r=n.appendChild(P.createElement("div")),r.innerHTML=t;u<r.childNodes.length;u++)c.push(r.childNodes[u]);r.textContent=""}else c.push(P.createTextNode(t));return n.textContent="",Q.foreach(c,function(t){if(e.appendChild(t),1===t.nodeType)for(r=Q.getAll(t,"script"),u=0;o=r[u++];)s.push(o)}),Q.isEmpty(s)||Q.scriptEval(s),e}throw x("context","context必须为DOM节点")},html:function(e,t){return e=Q.clear(e),e=Q.append(e,t)},replaceAll:function(e,t,n){if(3!==arguments.length)throw x("function:replaceAll","必须传入被替换字符串、查找替换的字符串和替换的字符串三个参数");if("string"!==Q.type(e)||"string"!==Q.type(t)||"string"!==Q.type(n))throw x("function:replaceAll","函数所有参数类型都必须为string");return t=t.split(""),Q.foreach(t,function(e,t,n){n[t]=["$","(",")","*","+",".","[","]","?","\\","^","{","}","|"].indexOf(e)!==-1?"\\"+e:e}),e.replace(new RegExp(t.join(""),"gm"),n)},isWindow:function(e){try{return"object"===Q.type(e)&&!!e.eval&&!!e.setInterval&&e.window===e.window.window}catch(t){return!1}}}),Y=function(){function e(e){c=this,s=n(c,e.type),"array"===Q.type(s)&&s.length>0&&Q.foreach(s,function(t){"function"===Q.type(t)&&t.call(c,e),t.once===!0&&r.remove(c,e.type,t,t.useCapture)})}function n(e,t,n,r){function c(e,t,n,r,o){if(a=Q.type(n),i=Q.type(r),"string"===a){if("function"===i){if(o){if(u=e[n].length>0){for(;--u>-1;)e[n][u]&&e[n][u].guid===r.guid&&O.call(e[n],u,1);0===e[n].length&&delete e[n]}}else e[n]=e[n]||[],e[n].push(r);return e}return e[n]}return e}if(e){if(e.valueOf.override!==!0){if(!n||r)return t?[]:{};var s={};o=e.valueOf,Object.defineProperty(e,"valueOf",{value:function(){return arguments.length>0?c.apply(null,[s].concat(H.call(arguments))):o.call(e)}}),e.valueOf.override=!0}return e.valueOf(e,t,n,r)}return c(l,null,t,n,r)}var r,o,a,i,u,c,s,l={},f=/\S+/g,d={DOMContentLoaded:function(){return!!P.addEventListener}},h={load:"HTMLEvents",unload:"HTMLEvents",abort:"HTMLEvents",error:"HTMLEvents",select:"HTMLEvents",change:"HTMLEvents",submit:"HTMLEvents",reset:"HTMLEvents",focus:"HTMLEvents",blur:"HTMLEvents",resize:"HTMLEvents",scroll:"HTMLEvents",keypress:"KeyboartEvent",keyup:"KeyboartEvent",keydown:"KeyboartEvent",contextmenu:"MouseEvents",click:"MouseEvents",dbclick:"MouseEvents",mouseout:"MouseEvents",mouseover:"MouseEvents",mouseenter:"MouseEvents",mouseleave:"MouseEvents",mousemove:"MouseEvents",mousedown:"MouseEvents",mouseup:"MouseEvents",mousewheel:"MouseEvents"};return r={support:function(e,t){t=t||P.createElement("div");var n;return"function"===Q.type(d[e])?n=d[e]():(e="on"+e,n=e in t,!n&&t.setAttribute&&(t.setAttribute(e,""),n="function"===Q.type(t[e]))),n},on:function(o,a,i,u,c){if(Q.isWindow(o)||"object"===Q.type(o)&&o.nodeType||(c=u,u=i,i=a,a=o,o=t),o&&(3===o.nodeType||8===o.nodeType))throw x("function event.on:elem","elem参数不能为文本节点或注释节点");if("string"!==Q.type(a))throw x("function event.on:types","types参数类型必须为string");if("function"!==Q.type(i))throw x("function event.on:listener","listener参数类型必须为function");i.guid||(i.guid=p()),c===!0&&(i.once=!0,i.useCapture=u),I.call(a||"",f,function(t){n(o,t,i),o&&r.support(t,o)&&o.addEventListener&&o.addEventListener(t,e,!!u)})},remove:function(o,a,i,u){if(Q.isWindow(o)||"object"===Q.type(o)&&o.nodeType||(u=i,i=a,a=o,o=t),o.nodeType&&(3===o.nodeType||8===o.nodeType))throw x("function event.on:elem","elem参数不能为文本节点或注释节点");if("string"!==Q.type(a))throw x("function event.remove:types","types参数类型必须为string");if("function"!==Q.type(i))throw x("function event.remove:listener","listener参数类型必须为function");Q.isEmpty(n(o))||I.call(a||"",f,function(t){Q.isEmpty(n(o,t,i,!0))&&o&&r.support(t,o)&&o.removeEventListener&&o.removeEventListener(t,e,!!u)})},emit:function(n,r){if("string"===Q.type(n)&&(r=n,n=t),n&&(3===n.nodeType||8===n.nodeType))throw x("function event.emit:elem","elem参数不能为文本节点或注释节点");if("string"!==Q.type(r))throw x("function event.emit:types","types参数类型必须为string");I.call(r||"",f,function(t){if(Y.support(t,n)){var r=P.createEvent(h[t]||"CustomEvent");r.initEvent(t,!0,!1),P.dispatchEvent(r)}else e.call(n,{type:t})})}}}();f.prototype={constructor:f,then:function(e,t){var n=this;return new f(function(r,o){n.handle({onFulfilled:function(){var t="function"===Q.type(e)&&e.apply(null,arguments)||arguments;n._isThenable(t)&&t.then(function(){r()},function(e){o(e)})},onRejected:function(e){var n="function"===Q.type(t)&&t(e)||e;o(n)}})})},done:function(e){return this.handle({onFulfilled:e}),this},fail:function(e){return this.handle({onRejected:e}),this},always:function(e){this.handle({onFulfilled:e,onRejected:e})}},f.when=function(){};var Z=Q.extend({},{request:y(),get:y("GET"),post:y("POST")}),ee=function(){function e(e,t){Q.foreach(e,function(e,n){if(r[t].hasOwnProperty(n))throw C("plugin",n+"插件已存在");r[t][n]=e})}function n(e){Q.foreach(e,function(e,t){if(o.hasOwnProperty.call(t))throw C("driver",t+"元素驱动器已存在");o[t]=e})}var r={};r[z]={},r[V]={};var o={},a={},i={},u={page:null,module:[]};return{componentCreater:function(r,o,a){var i,u=Q.type(r);return"object"===u?(a=o,o=r,r=t):(i=o,o={},o[r]=i),a===z||a===V?e(o,a):a===J&&n(o),i||o},componentFactory:function(e,n){return n===G||n===t?r[z][e]||r[V][e]:n===J?o[e]:null},addRedirect:function(e,t){if(a.hasOwnProperty(e))throw C("module",e+"页面模块已存在");a[e]=t},getRedirect:function(e){return a[e]},addModule:function(e,t){if(i.hasOwnProperty(e))throw C("module",e+"模块已存在");i[e]=t},getModule:function(e){return i[e]},setPageFactory:function(e){"function"===Q.type(e)&&(u.page=e)},addUnexecutedModule:function(e){"function"===Q.type(e)&&k.call(u.module,e)},queueInvoke:function(){X===U&&"function"===Q.type(u.page)?u.page():X===W&&u.module.length>0&&Q.foreach(u.module,function(e){"function"===Q.type(e)&&e()})}}}();Q.extend(m,{aModule:"ice-module",aSrc:"ice-src",aCache:"ice-cache",aBase:"ice-base",aLoading:"ice-loading",aFinish:"ice-finish",aHref:"href",aAction:"action",aTargetMod:"ice-target-module"}),Q.extend(m,{history:{entity:e.history,replace:function(e,t,n){this.entity.replaceState(e,t,n)},push:function(e,t,n){this.entity.pushState(e,t,n)},getOriginalState:function(){return this.entity.state},state:{},signature:null,setState:function(e,t,n){this.state[e]=t,n===!0||(this.signature=e)},getState:function(e){return this.state[e]}},moduleRecord:{},setModuleRecord:function(e,t,n){if(m.moduleRecord[e]=t,n===!0){var r={};Q.foreach(m.moduleRecord,function(e,t){"object"===Q.type(Q.s("*[ice-module="+t+"]"))&&(r[t]=e)}),m.moduleRecord=r}},getModuleRecord:function(e){return m.moduleRecord[e]},getFormatModuleRecord:function(){var e=[];return Q.foreach(m.moduleRecord,function(t,n){k.call(e,n+(w.params.moduleSeparator||"")+t)}),"/"+N.call(e,"/")},click:function(e){var t=this.getAttribute(m.aTargetMod),n=this.getAttribute(m.aHref),r=Q.s("*["+m.aModule+"="+t+"]");if(e.preventDefault(),"object"!==Q.type(r))throw C("module","找不到"+t+"模块");s(r)===n||m(n,r,null,w.params.header[n],null,null,null,null,null,null,!0)}});g.prototype={constructor:g,putWaiting:function(e){this.waiting.push(e)},dropWaiting:function(e){var t=this.waiting.indexOf(e);return t!==-1&&this.waiting.splice(t,1),this.waiting.length},putLoad:function(e,t){this.load[e]=t},getLoad:function(e){return this.load[e]}},g.suffix=".js",g.moduleName="data-moduleName",g.scriptFlag="module-loading",g.loaderID="loader-ID",g.topModuleName="*",g.loaders={},g.create=function(e,t,n){return g.loaders[e]=new g(t,n),g.loaders[e]},g.getCurrentModule=function(){try{____a.____b()}catch(e){if(e.stack){var t=/\?m=(\S+)&guid=([\d]+):?/.exec(e.stack);return{name:t[1],guid:t[2]}}}},g.inject=function(e,t){var n,r,o=[b];return Q.foreach(e.deps,function(e){(n=ee.componentFactory(e,G))?o.push(n):(n=g.inject(t.getLoad(e),t),ee.componentCreater(e,n,V),o.push(n))}),e.type===$||e.type===B?r=function(){e.factory.apply(null,o)}:e.type===G?r=e.factory.apply(null,o):e.type===J,r},g.factoryInvoke=function(e,t){if(t===$)if(X===_)ee.setPageFactory(e);else{if(X!==U)throw A("error","页面状态错误(page)");e&&e(),X=W,ee.queueInvoke()}else if(t===B)if(X===U)ee.addUnexecutedModule(e);else{if(X!==W)throw A("error","页面状态错误(module)");e&&e()}},g.onScriptLoaded=function(e){var t=e.target.getAttribute(g.loaderID),n=g.loaders[t];if(0===n.dropWaiting(e.target.getAttribute(g.moduleName))){var r=g.inject(n.getLoad(g.topModuleName),n);g.factoryInvoke(r,n.getLoad(g.topModuleName).type),delete g.loaders[t]}},ee.componentCreater({event:Y,Promise:f,animation:d,language:h,util:Q,http:Z},z),v.prototype={constructor:v},Q.extend(b,{refreshModule:function(e,t,n,r){"object"===Q.type(e)&&1===arguments.length},submit:function(e,t,n,r){}});var te=["@","$","^","*","|",":","~","!"];Q.extend(D,{config:w}),function(){var e;if(e=Q.s("script[config]").getAttribute("config")){var t=P.createElement("script");t.src=e,Q.appendScript(t,function(){X=K,Y.emit("parsed")})}else w({}),X=K}(),function(t){function n(){Y.remove(P,"DOMContentLoaded",n),Y.remove(e,"load",n),t()}"complete"===P.readyState?t():(Y.on(P,"DOMContentLoaded",n),Y.on(e,"load",n))}(function(){function t(){T(),X=U,Y.emit("page")}X===K?t():Y.on("parse",t,!1,!0),l(F.call(e.location.pathname,"/"),function(e,t){m.setModuleRecord(e,t)}),m.history.setState(e.location.pathname,null),X=U,ee.queueInvoke()}),Q.extend(D,{page:function(e,n){if(0===arguments.length)throw x("function ice.page","至少需要传入模块主函数参数");e&&!n&&(n=e,e=[]);var r=Q.type(e),o=Q.type(n);if(e!==t&&null!==e&&"array"!==r)throw x("function ice.page:dependence","方法第一个参数类型为Array，也可不传入第一个参数或传入null，方法将自动忽略此参数");if("function"!==o)throw x("function ice.page:factory","至少需要传入模块主函数参数，而不是其他类型参数");Y.on("page",function(){M(g.topModuleName,e,n,$)})},module:function(e,n){if(0===arguments.length)throw x("function ice.module","至少需要传入模块主函数参数");e&&!n&&(n=e,e=[]);var r=Q.type(e),o=Q.type(n);if(e!==t&&null!==e&&"array"!==r)throw x("function ice.module:dependence","方法第一个参数类型为Array，也可不传入第一个参数或传入null，方法将自动忽略此参数");if("function"!==o)throw x("function ice.module:factory","至少需要传入模块主函数参数，而不是其他类型参数");M(g.topModuleName,e,n,B)},control:function(e){return T(e,!0)}}),Q.extend(e,{plugin:function(e,n){if(0===arguments.length)throw x("function ice.plugin","至少需要传入模块主函数参数");e&&!n&&(n=e,e=[]);var r=Q.type(e),o=Q.type(n);if(e!==t&&null!==e&&"array"!==r)throw x("function ice.plugin:dependence","方法第一个参数类型为Array，也可不传入第一个参数或传入null，方法将自动忽略此参数");if("function"!==o)throw x("function ice.plugin:factory","至少需要传入模块主函数参数，而不是其他类型参数");M(g.getCurrentModule()||"",e,n,G)},driver:function(e,n){if(0===arguments.length)throw x("function ice.driver","至少需要传入模块主函数参数");e&&!n&&(n=e,e=[]);var r=Q.type(e),o=Q.type(n);if(e!==t&&null!==e&&"array"!==r)throw x("function ice.driver:dependence","方法第一个参数类型为Array，也可不传入第一个参数或传入null，方法将自动忽略此参数");if("function"!==o)throw x("function ice.driver:factory","至少需要传入模块主函数参数，而不是其他类型参数");M(g.topModuleName,e,n,J)}})}(window);