/*
 ice V0.1.0
 @author:JOU<huzhen555@qq.com>
 License:MIT
*/
!function(t,e){"use strict";function n(t){return function(e,n){var r="[ice:"+(t?t+"-":"")+e+"] "+n;return new Error(r)}}function r(t){return null!==t?t instanceof Array?"array":typeof t:"null"}function o(t,e,n){var o,a=r(t),i=r(e),u=0;if("array"===a&&n===!0)for(;u<t.length&&(o=e(t[u],u,t),o!==!1);u++);else{if("object"!==a&&n===!0)throw M("target","第一个参数类型必须为array或object");for(u in t)if(o=e(t[u],u,t),o===!1)break}if("function"!==i)throw M("callback","第二个参数类型必须为function")}function a(t,e){if("array"===r(t)){for(var n=t.length;--n>=0;)if(t[n]===e)return!0;return!1}throw M("function inArray:array","第一个参数必须为数组")}function i(){var t,n=arguments[0],i=r(n),u=N.call(arguments,1);if("array"!==i&&"object"!==i&&"function"!==i)throw M(i,"合并父体类型需为Array、Object或Function");return o(u,function(u){t=r(u),"array"===i?"array"===t||"object"===t?o(u,function(t){a(n,t)||n.push(t)}):null!==t&&t!==e&&n.push(u):"object"!==i&&"function"!==i||"object"===t&&o(u,function(t,e){n[e]=t})}),n}function u(t,e){e=!!e;var n=/\./g,r=/\//g,o=".",a="/";return e?t.replace(r,o):t.replace(n,a)}function s(t,e){t.currentPath=e}function c(t){return t.currentPath||""}function l(t,e){var n,r=[].concat(t);if("/"===T.params.moduleSeparator)for(var o=0;o<r.length;)""!==r[o]?(e(r[o],r[o+1]||""),o+=2):o++;else Q.foreach(r,function(t){""!==t&&(n=t.split(T.params.moduleSeparator),e(n[0],n[1]))})}function p(){return setTimeout(1)+""}function d(t){function e(){s===a&&(s=i,r=arguments,Q.foreach(c,function(t){t.onFulfilled&&t.onFulfilled.apply(null,r)}))}function n(){s===a&&(s=u,o=arguments,Q.foreach(c,function(t){t.onRejected&&t.onRejected.apply(null,o)}))}if("function"!==Q.type(t))throw M("function Promise","构造函数需传入一个函数参数");var r,o,a=0,i=1,u=2,s=a,c=[];this._isThenable=function(t){var e=Q.type(t);if(t&&("object"===e||"function"===e)){var n=t.then;if("function"===Q.type(n))return!0}return!1},this.handle=function(t){s===a?c.push(t):s===i&&"function"===Q.type(t.onFulfilled)?t.onFulfilled.apply(null,r):s===u&&"function"===Q.type(t.onRejected)&&t.onRejected.apply(null,o)},t(e,n)}function f(){}function h(){}function y(n){var r,o,a,i,u,s,c,l,f,h=/^(.*?):[ \t]*([^\r\n]*)$/gm,y=/%20/g,m=/#.*$/,g=/([?&])_=[^&]*/,v=/\?/,b=/^(?:GET|HEAD)$/,T=/^(?:TEXT|JSON|SCRIPT|JSONP)$/,w=/^(?:checkbox|radio)$/i,x=/^(?:submit|button|image|reset|file)$/i,E=/^(?:input|select|textarea|keygen)/i,M=/\r?\n/g,j={"*":["*/"]+["*"],text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},C={method:"GET",url:"",data:"",async:!0,cache:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"TEXT",headers:{}},A=function(t){return function(n){return t?(r=n[0],o=n[1],a=n[2],i=n[3],"string"===Q.type(a)&&i===e&&(i=a,a=e),"function"===Q.type(o)?(a=o,o=e):T.test((o||"").toUpperCase())&&(i=o,o=e),c={url:r,args:o||e,success:a||e,dataType:i||e,method:t}):c=n[0],Q.extend({},C,c)}}(n),L={text:function(t){return t},json:function(t){return"object"===Q.type(t)?t:JSON.parse(t)},script:function(t){Q.scriptEval(t)}},R=function(e){var n=e.transport;if(!n.completed){n.completed=!0,n.timeoutID&&t.clearTimeout(n.timeoutID);try{s=L[n.dataType]&&L[n.dataType](s)}catch(r){n.status=500,n.statusText="Parse Error: "+r}200===n.status&&"script"!==i?n.callbacks.success&&n.callbacks.success(s,n.statusText,e):500===n.status&&n.callbacks.error&&n.callbacks.error(e,n.statusText),n.callbacks.complete&&n.callbacks.complete(e,n.statusText)}},H={xhr:function(){return{send:function(t,e){var n,r=this,o=this.xhr=function(){try{return new XMLHttpRequest}catch(t){}}();if(t.crossDomain&&!1 in o)throw S("crossDomain","该浏览器不支持跨域请求");o.open(t.method,t.url,t.async,t.username,t.password),t.mimeType&&o.overrideMimeType&&o.overrideMimeType(t.mimeType),o.setRequestHeader("X-Requested-With","XMLHTTPRequest");for(n in this.headers)o.setRequestHeader(n,this.headers[n]);"function"===Q.type(t.abort)&&Y.support("abort",o)&&(o.onabort=function(){t.abort(e.transport.statusText)}),Y.support("error",o)?o.onload=o.onerror=function(t){e.transport.status=o.status>=200&&o.status<300||304===o.status||1223===o.status?200:500,r.done(e)}:o.onreadystatechange=function(){o.readyState===XMLHttpRequest.DONE&&(e.transport.status=o.status>=200&&o.status<300||304===o.status||1223===o.status?200:500,r.done(e))};try{o.send(t.hasContent&&t.data||null)}catch(a){throw S("send",a)}},done:function(t){var e=this.xhr;e.onload=e.onerror=e.onreadystatechange=null,this.abortText&&"function"===Q.type(e.abort)?(this.status=0,this.statusText=this.abortText,e.abort()):(this.responseHeadersString=e.getAllResponseHeaders(),this.status=e.status,this.statusText=e.statusText,s=e.responseText,R(t))}}},script:function(e){var n;return{send:function(t,e){function r(t){n.readyState&&"loaded"!==n.readyState&&"complete"!==n.raeadyState?(this.status=500,this.statusText="error"):(this.status=200,this.statusText="success"),o.done(e)}var o=this;n=F.createElement("script"),n.src=t.url,Q.appendScript(n,r,r)},done:function(r){return this.abortText?(n.parentNode.removeChild(n),this.status=0,void(this.statusText=this.abortText)):("JSONP"===e.dataType&&(i="json","function"!==Q.type(t[e.jsonpCallback])?(this.status=200,this.statusText="success",s=t[e.jsonpCallback]):(this.status=500,this.statusText="error")),void R(r))}}},jsonp:function(e){var n=H.script(e),r=e.jsonpCallback="jsonpCallback"+Date.now();return t[r]=function(e){t[r]=e},e.data+=(e.data?"&":"")+"callback="+r,{send:function(t,e){n.send(t,e)},done:function(t){n.done(t)}}},upload:function(){var t=F.createElement("iframe"),e="upload-iframe-unique-"+p();return t.setAttribute("id",e),t.setAttribute("name",e),t.style.position="absolute",t.style.top="9999px",t.style.left="9999px",(F.body||F.documentElement).appendChild(t),{send:function(n,r){var o=this,a={action:n.data.action||"",method:n.data.method||"",enctypt:n.data.enctypt||"",target:n.data.target||""};Y.on(t,"load",function(){o.done(r)},!1,!0),n.data.setAttribute("action",n.url),n.data.setAttribute("method","POST"),n.data.setAttribute("target",e),"multipart/form-data"!==n.data.getAttribute("enctypt")&&(n.data.encoding="multipart/form-data"),n.data.submit(),Q.foreach(a,function(t,e){t?n.data.setAttribute(e,t):n.data.removeAttribute(e)})},done:function(e){var n,r,o=t.contentWindow.document;o.body&&(this.status=200,this.statusText="success",s=(n=o.body.firstChild)&&"PRE"===n.nodeName.toUpperCase()&&n.firstChild?n.innerHTML:o.body.innerHTML,/&\S+;/.test(s)&&(r={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'},s=s.replace(/&(lt|gt|nbsp|amp|quot);/gi,function(t,e){return r[e]}))),R(e),t.parentNode.removeChild(t)}}}};return function(){var t=A(arguments),e={transport:null,setRequestHeader:function(t,e){this.transport.completed||(this.transport.headers=this.transport.headers||{},this.transport.headers[t.toLowerCase()]=e)},getResponseHeader:function(t){var e;if(this.transport.completed){if(!this.transport.respohseHeader)for(this.transport.respohseHeader={};e=h.exec(this.transport.responseHeadersString||"");)this.transport.respohseHeader[e[1].toLowerCase()]=e[2];e=this.transport.responseHeader[t]}return e||null},getAllResponseHeaders:function(){return this.transport.completed?this.transport.responseHeadersString:null},overrideMimeType:function(e){this.transport.completed||(t.mimetype=e)},abort:function(t){this.transport&&(this.transport.abortText=t||"abort",this.transport.done())},addEventListener:function(t,e){this.transport.completed||(this.transport.callbacks=this.transport.callbacks||{},this.transport.callbacks[t]=e)}};if("object"===Q.type(t.data)){var n=[];if(t.data.nodeName&&"FORM"===t.data.nodeName.toUpperCase()){t.method=t.data.getAttribute("method")||"POST",t.url=t.data.getAttribute("src")||t.url;try{t.data=new FormData(t.data)}catch(r){var o,a=N.call(t.data.elements);Q.foreach(a,function(t){return"file"===t.type?(o=!0,!1):void(!t.name||t.getAttribute("disabled")||!E.test(t.nodeName)||x.test(t.type)||!t.checked&&w.test(t.type)||n.push(t.name+"="+t.value.replace(M,"\r\n")))}),o||(t.data=n.join("&"))}}else Q.foreach(t.data,function(t,e){n.push(e+"="+t)}),t.data=n.join("&")}if(t.hasContent=!b.test(t.method=t.method.toUpperCase()),t.dataType=T.test(t.dataType=(t.dataType||"").toUpperCase())?t.dataType:"TEXT",t.timeout=t.timeout>0?t.timeout:0,!t.crossDomain){var i=F.createElement("a"),s=F.createElement("a");i.href=location.href,s.href=t.url;try{t.crossDomain=i.protocol+"//"+i.host!=s.protocol+"//"+s.host}catch(r){t.crossDomain=!0}}return new d(function(n,r){t.data.nodeName&&"FORM"===t.data.nodeName.toUpperCase()?u="upload":"SCRIPT"===t.dataType&&t.async===!1&&(u="xhr"),e.transport=(H[u]||H.xhr)(t),e.transport.dataType=t.dataType.toLowerCase(),t.hasContent?t.data&&"string"===Q.type(t.data)&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&(t.data=t.data.replace(y,"+")):(l=t.url.replace(m,""),f=t.url.slice(l.length),l+=t.data?(v.test(l)?"&":"?")+t.data:"",l=l.replace(g,""),l+=t.cache===!1?(v.test(l)?"&":"?")+"_="+Date.now():"",t.url=l+(f||"")),t.contentType&&e.setRequestHeader("Content-Type",t.contentType),e.setRequestHeader("Accept",j[e.transport.dataType]?j[e.transport.dataType]+", */*; q=0.01":j["*"]);for(var o in t.headers)e.setRequestHeader(o,t.headers[o]);"function"===Q.type(t.beforeSend)&&t.beforeSend(e,t),Q.foreach(["complete","success","error"],function(o){"success"===o?t[o]=t[o]||n:"error"===o&&(t[o]=t[o]||r),e.addEventListener(o,t[o])}),t.async&&t.timeout>0&&(e.transport.timeoutID=setTimeout(function(){e.abort("timeout")},t.timeout)),e.transport.send(t,e)})}}function m(n,o,a,i,u,l,p,d,f,h,y,g){var v,b,w,x,M,S,j,C,A,L,R,N=Q.type(i),H=":m",k=":v",O=F.title,P=[];if(M="string"===Q.type(n)?[{url:n,entity:o,data:a}]:n,Q.foreach(M,function(t,n){v=t.entity.getAttribute(m.aModule),C=v+"_"+t.url,A=T.params.urlRule,b=t.entity.getAttribute(m.aCache),w="true"===b||T.params.redirectCache===!0&&"false"!==b,x="false"!==t.entity.getAttribute(m.aBase)&&T.params.base.url.length>0,t.isCache===!0&&"function"!==r&&(S=tt.getRedirect(C))?(Q.html(t.entity,S),"string"===N&&i.length>0&&(F.title=i)):(A=Q.replaceAll(A||"",H,v),A=Q.replaceAll(A||"",k,t.url),L=A.indexOf("/"),A=x?T.params.base.url+(0===L?q.call(A,1):A):0===L?A:"/"+A,Z.request({url:A,data:t.data||"",method:/^(GET|POST)$/i.test(u)?u.toUpperCase():"GET",timeout:l||0,beforeSend:function(){"function"===Q.type(p)&&p(t)},abort:function(){"function"===Q.type(h)&&h(t)}}).done(function(e){try{e=JSON.parse(e),j=e[T.params.htmlKey]}catch(n){j=e}Q.html(t.entity,j),t.isCache===!0&&tt.addRedirect(C,j),i="string"===N?i:"function"===N?i(e[T.params.codeKey]||null)||null:null,"string"===Q.type(i)&&i.length>0&&(F.title=i),"function"===Q.type(d)&&d(t)}).fail(function(t){"function"===Q.type(t)&&t(o,t)})),R=c(t.entity),s(t.entity,t.url),P.push({url:R,moduleName:v,data:t.data,title:"0"===n?O:e}),y===!0&&m.setModuleRecord(v,t.url,!0)}),y===!0){if(!m.history.entity.pushState)throw E("History API","浏览器不支持HTML5 History API");m.history.setState(m.history.signature,P,!0),g!==!0&&m.history.push(null,M[0].title,m.getFormatModuleRecord()),m.history.setState(t.location.pathname,null)}}function g(t,e){this.load={},this.waiting=[],this.load[t]=e}function v(t,e){this.waiting=[]}function b(t){}function T(t){if("object"!==Q.type(t))throw j("params","配置参数为参数对象");var n,r={base:{url:"",plugin:"",driver:"",lang:""},stateMark:et[0],redirectCache:!0,codeKey:"code",htmlKey:"html",moduleSeparator:"-",urlRule:":m/:v.html",header:{}};Q.isEmpty(t)||(t.base!==e&&(t.base.url!==e&&(n=Q.type(t.base.url),t.base.url="string"===n?t.base.url:"function"===n?t.base.url():"",t.base.url="/"===t.base.url.substr(-1,1)?t.base.url:t.base.url+"/"),t.base.plugin!==e&&(n=Q.type(t.base.plugin),t.base.plugin="string"===n?t.base.plugin:"function"===n?t.base.plugin():"",t.base.plugin="/"===t.base.plugin.substr(-1,1)?t.base.plugin:t.base.plugin+"/"),t.base.driver!==e&&(n=Q.type(t.base.driver),t.base.driver="string"===n?t.base.driver:"function"===n?t.base.driver():"",t.base.driver="/"===t.base.driver.substr(-1,1)?t.base.driver:t.base.driver+"/")),t.base!==e&&t.base.lang!==e&&(n=Q.type(t.base.lang),t.base.lang="string"===n?t.base.lang:"function"===n?t.base.lang():"",t.base.lang="/"===t.base.lang.substr(-1,1)?t.base.lang:t.base.lang+"/"),t.stateMark=et.indexOf(t.stateMark)===-1?et[0]:t.stateMark,t.redirectCache=t.redirectCache!==!1),t.base=Q.extend(r.base,t.base),Q.extend(T,{params:Q.extend(r,t)})}function w(n,r){if(r===!0){if(n===e||null===n||1!==n.nodeType&&11!==n.nodeType)throw M("function control:node","control方法要求传入一个有效的node对象或DocumentFragment对象")}else r!==e||n!==e&&null!==n||(n=Q.s("body"));var o,a,i,u,c,p,d,f=[],h={};1===n.nodeType&&null!==n.getAttribute(m.aModule)&&f.push(n),f=f.concat(Q.S("*["+m.aModule+"]",n)),Q.foreach(f,function(t){return 1===t.nodeType&&void((o=t.getAttribute(m.aSrc))&&(a=t.getAttribute(m.aCache),o=m.getModuleRecord(t.getAttribute(m.aModule))||o,s(t,o),m(o,t)))}),Q.foreach(N.call(Q.S("*["+m.aHref+"]")),function(t){"LINK"!==t.nodeName&&t.getAttribute(m.aTargetMod)&&Y.on(t,"click",m.click)}),Y.on(t,"popstate",function(e){i=m.history.getState(t.location.pathname),u={},c={},h={},p=[],"array"===Q.type(i)&&i.length>0?(Q.foreach(i,function(t){p.push({url:t.url,entity:Q.s("*["+m.aModule+"="+t.moduleName+"]"),data:t.data})}),m(p,null,null,i[0].title,null,null,null,null,null,null,!0,!0)):(l(P.call(m.history.signature,"/"),function(t,e){u[t]=e}),l(P.call(t.location.pathname,"/"),function(t,e){c[t]=e}),Q.foreach(c,function(t,e){u[e]!==t&&(h[e]=t)}),Q.foreach(u,function(t,e){c[e]!==t&&(h[e]=null)}),Q.foreach(h,function(t,e){d=Q.s("*["+m.aModule+"="+e+"]"),t=null===t?d.getAttribute(m.aSrc):t,p.push({url:t,entity:d,data:null})}),m(p,null,null,T.params.header[p[0].url],null,null,null,null,null,null,!0,!0))})}function x(t,e,n,r){var o,a,i=/^function\s*\((.*)\)\s*/,s=i.exec(n.toString())[1].split(","),c=r!==G?p():t.guid,l=0;Q.foreach(s,function(t,e,n){n[e]=Q.trim(t)}),e="array"===Q.type(e)?e.slice(0,s.length-1):e,o={type:r,deps:e,factory:n,args:s},r!==G?a=g.create(c,t,o):(a=g.loaders[c],a.putLoad(t.name,o)),Q.foreach(e,function(t){if(t=u(t),!tt.componentFactory(t,G)){a.putWaiting(t);var e=F.createElement("script");e.src=T.params.base.plugin+t+g.suffix+"?m="+t+"&guid="+c,e.setAttribute(g.moduleName,t),e.setAttribute(g.scriptFlag,""),e.setAttribute(g.loaderID,c),Q.appendScript(e,g.onScriptLoaded),l++}}),0===l&&t===g.topModuleName&&g.factoryInvoke(g.inject(o,a),r)}var E=n("env"),M=n("arg"),S=n("request"),j=n("config"),C=n("runtime"),A=n("module");if("undefined"==typeof t||"object"!=typeof t.document)throw E("browser","ice只能在浏览器环境中运行...");var L=[],R="",N=L.slice,H=L.splice,k=L.push,O=L.join,P=(L.concat,R.toUpperCase,R.toLowerCase,R.split),q=R.substr,D=R.replace,F=(Object.prototype.toString,Object.prototype.hasOwnProperty,Object.prototype.isPrototypeOf,t.document),I=t.ice||(t.ice={}),_=(function(t){var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.* rv:([\w.]+)|)/.exec(t)||[],n=/(mac)/.exec(t)||/(windows)/.exec(t)||/(ipad)/.exec(t)||/(iphone)/.exec(t)||/(android)/.exec(t)||[],r={};return r[e[1]||""]=!0,r.version=e[2]||"0",r.platform=n[0]||"",r}(t.navigator.userAgent.toLowerCase()),0),U=1,K=2,$=3,W=_,X=1,B=2,G=3,J=4,z="BUILT_IN",V="EXTERNAL",Q=i({},{extend:i,type:r,foreach:o,inArray:a,hasKey:function(t,e){if("object"===Q.type(t)){var n=!1;return Q.foreach(t,function(t,r){if(r===e)return n=t,!1}),n}throw M("function hasKey:object","检测对象必须为object类型")},isEmpty:function(t){var e=!0,n=Q.type(t);if("array"!==n&&"object"!==n)throw M("object","参数类型必须为array或object");return Q.foreach(t,function(){return e=!1,!1}),e},trim:function(t){if("string"!==Q.type(t))throw M("arg-type","参数类型必须为string");return t.replace(/(^\s*)|(\s*$)/g,"")},s:function(t,e){return(e||F).querySelector(t)},S:function(t,e){return N.call((e||F).querySelectorAll(t))},getAll:function(t,e){var n=t.getElementsByTagName?t.getElementsByTagName(e||"*"):t.querySelectorAll?t.querySelectorAll(e||"*"):[];return t.nodeName===e.toUpperCase()?N.call(n).concat([t]):N.call(n)},appendScript:function(t,e,n){var r=F.createElement("script");r.type="text/javascript",Q.foreach(t.attributes,function(t){2===t.nodeType&&r.setAttribute(t.nodeName,t.nodeValue)}),t.src?(r.async=!0,Y.on(r,"load readystatechange",function(t){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.raeadyState||e&&e(t),r.parentNode.removeChild(r)}),Y.on(r,"error",function(){r.parentNode.removeChild(r)}),F.head.appendChild(r)):t.text&&(r.text=t.text||"",F.head.appendChild(r).parentNode.removeChild(r))},scriptEval:function(t){var e=Q.type(t);if("string"===e){var n=F.createElement("script");n.type="text/javascript",n.text=t,Q.appendScript(n)}else if("object"===e&&1===t.nodeType&&"script"===t.nodeName.toLowerCase())Q.appendScript(t);else{if("array"!==e)throw M("arg","参数必须为javascript代码片段、script标签或script标签数组");var r=t.slice(0);Q.foreach(t,function(t){return H.call(r,0,1),t.src?(Q.appendScript(t,function(){r.length>0&&Q.scriptEval(r)}),!1):void Q.appendScript(t)})}},clear:function(t){if(1!==t.nodeType)throw M("context","元素类型必须是dom节点");return t.textContent="",t},append:function(t,e){var n,r,o,a=/<|&#?\w+;/,i=Q.type(e),u=0,s=[],c=[];if(1===t.nodeType){if("string"!==i||a.test(e))if("object"===i)e.nodeType&&s.push(e);else{for(n=F.createDocumentFragment(),r=n.appendChild(F.createElement("div")),r.innerHTML=e;u<r.childNodes.length;u++)s.push(r.childNodes[u]);r.textContent="",n.textContent=""}else s.push(F.createTextNode(e));return Q.foreach(s,function(e){if(t.appendChild(e),1===e.nodeType)for(r=Q.getAll(e,"script"),u=0;o=r[u++];)c.push(o)}),Q.isEmpty(c)||Q.scriptEval(c),t}throw M("context","context必须为DOM节点")},html:function(t,e){return t=Q.clear(t),t=Q.append(t,e)},replaceAll:function(t,e,n){if(3!==arguments.length)throw M("function:replaceAll","必须传入被替换字符串、查找替换的字符串和替换的字符串三个参数");if("string"!==Q.type(t)||"string"!==Q.type(e)||"string"!==Q.type(n))throw M("function:replaceAll","函数所有参数类型都必须为string");return e=e.split(""),Q.foreach(e,function(t,e,n){n[e]=["$","(",")","*","+",".","[","]","?","\\","^","{","}","|"].indexOf(t)!==-1?"\\"+t:t}),t.replace(new RegExp(e.join(""),"gm"),n)},isWindow:function(t){try{return"object"===Q.type(t)&&!!t.eval&&!!t.setInterval&&t.window===t.window.window}catch(e){return!1}}}),Y=function(){function t(t){s=this,c=n(s,t.type),"array"===Q.type(c)&&c.length>0&&Q.foreach(c,function(e){"function"===Q.type(e)&&e.call(s,t),e.once===!0&&r.remove(s,t.type,e,e.useCapture)})}function n(t,e,n,r){function s(t,e,n,r,o){if(a=Q.type(n),i=Q.type(r),"string"===a){if("function"===i){if(o){if(u=t[n].length>0){for(;--u>-1;)t[n][u]&&t[n][u].guid===r.guid&&H.call(t[n],u,1);0===t[n].length&&delete t[n]}}else t[n]=t[n]||[],t[n].push(r);return t}return t[n]}return t}if(t){if(t.valueOf.override!==!0){if(!n||r)return e?[]:{};var c={};o=t.valueOf,Object.defineProperty(t,"valueOf",{value:function(){return arguments.length>0?s.apply(null,[c].concat(N.call(arguments))):o.call(t)}}),t.valueOf.override=!0}return t.valueOf(t,e,n,r)}return s(l,null,e,n,r)}var r,o,a,i,u,s,c,l={},d=/\S+/g,f={DOMContentLoaded:function(){return!!F.addEventListener}},h={load:"HTMLEvents",unload:"HTMLEvents",abort:"HTMLEvents",error:"HTMLEvents",select:"HTMLEvents",change:"HTMLEvents",submit:"HTMLEvents",reset:"HTMLEvents",focus:"HTMLEvents",blur:"HTMLEvents",resize:"HTMLEvents",scroll:"HTMLEvents",keypress:"KeyboartEvent",keyup:"KeyboartEvent",keydown:"KeyboartEvent",contextmenu:"MouseEvents",click:"MouseEvents",dbclick:"MouseEvents",mouseout:"MouseEvents",mouseover:"MouseEvents",mouseenter:"MouseEvents",mouseleave:"MouseEvents",mousemove:"MouseEvents",mousedown:"MouseEvents",mouseup:"MouseEvents",mousewheel:"MouseEvents"};return r={support:function(t,e){e=e||F.createElement("div");var n;return"function"===Q.type(f[t])?n=f[t]():(t="on"+t,n=t in e,!n&&e.setAttribute&&(e.setAttribute(t,""),n="function"===Q.type(e[t]))),n},on:function(o,a,i,u,s){if(Q.isWindow(o)||"object"===Q.type(o)&&o.nodeType||(s=u,u=i,i=a,a=o,o=e),o&&(3===o.nodeType||8===o.nodeType))throw M("function event.on:elem","elem参数不能为文本节点或注释节点");if("string"!==Q.type(a))throw M("function event.on:types","types参数类型必须为string");if("function"!==Q.type(i))throw M("function event.on:listener","listener参数类型必须为function");i.guid||(i.guid=p()),s===!0&&(i.once=!0,i.useCapture=u),D.call(a||"",d,function(e){n(o,e,i),o&&r.support(e,o)&&o.addEventListener&&o.addEventListener(e,t,!!u)})},remove:function(o,a,i,u){if(Q.isWindow(o)||"object"===Q.type(o)&&o.nodeType||(u=i,i=a,a=o,o=e),o.nodeType&&(3===o.nodeType||8===o.nodeType))throw M("function event.on:elem","elem参数不能为文本节点或注释节点");if("string"!==Q.type(a))throw M("function event.remove:types","types参数类型必须为string");if("function"!==Q.type(i))throw M("function event.remove:listener","listener参数类型必须为function");Q.isEmpty(n(o))||D.call(a||"",d,function(e){Q.isEmpty(n(o,e,i,!0))&&o&&r.support(e,o)&&o.removeEventListener&&o.removeEventListener(e,t,!!u)})},emit:function(n,r){if("string"===Q.type(n)&&(r=n,n=e),n&&(3===n.nodeType||8===n.nodeType))throw M("function event.emit:elem","elem参数不能为文本节点或注释节点");if("string"!==Q.type(r))throw M("function event.emit:types","types参数类型必须为string");D.call(r||"",d,function(e){if(Y.support(e,n)){var r=F.createEvent(h[e]||"CustomEvent");r.initEvent(e,!0,!1),F.dispatchEvent(r)}else t.call(n,{type:e})})}}}();d.prototype={constructor:d,then:function(t,e){var n=this;return new d(function(r,o){n.handle({onFulfilled:function(){var e="function"===Q.type(t)&&t.apply(null,arguments)||arguments;n._isThenable(e)&&e.then(function(){r()},function(t){o(t)})},onRejected:function(t){var n="function"===Q.type(e)&&e(t)||t;o(n)}})})},done:function(t){return this.handle({onFulfilled:t}),this},fail:function(t){return this.handle({onRejected:t}),this},always:function(t){this.handle({onFulfilled:t,onRejected:t})}},d.when=function(){};var Z=Q.extend({},{request:y(),get:y("GET"),post:y("POST")}),tt=function(t){function n(t,e,n){if(t&&"string"===Q.type(t)){var r={};r[t]=e,e=r}Q.foreach(e,function(t,e){if(i[n].hasOwnProperty(e))throw A("plugin",e+"插件已存在");i[n][e]=t})}function r(t){return i[z][t]||i[V][t]||null}function o(t,e){if(t&&"string"===Q.type(t)){var n={};n[t]=e,e=n}Q.foreach(e,function(t,e){if(u.hasOwnProperty.call(e))throw A("driver",e+"元素驱动器已存在");u[e]=t})}function a(t){return u[t]||null}var i={};i[z]=t,i[V]={};var u={},s={},c={},l={page:null,module:[]};return{componentCreater:function(t,e,r){return r===z||r===V?n(t,e,r):r===J&&o(t,e),e},componentFactory:function(t,n){return n===G||n===e?r(t):n===J?a(t):null},addRedirect:function(t,e){if(s.hasOwnProperty(t))throw A("module",t+"页面模块已存在");s[t]=e},getRedirect:function(t){return s[t]},addModule:function(t,e){if(c.hasOwnProperty(t))throw A("module",t+"模块已存在");c[t]=e},getModule:function(t){return c[t]},setPageFactory:function(t){"function"===Q.type(t)&&(l.page=t)},addUnexecutedModule:function(t){"function"===Q.type(t)&&k.call(l.module,t)},queueInvoke:function(){W===K&&"function"===Q.type(l.page)?l.page():W===$&&l.module.length>0&&Q.foreach(l.module,function(t){"function"===Q.type(t)&&t()})}}}({event:Y,Promise:d,animation:f,language:h,util:Q,http:Z});Q.extend(m,{aModule:"ice-module",aSrc:"ice-src",aCache:"ice-cache",aBase:"ice-base",aLoading:"ice-loading",aFinish:"ice-finish",aHref:"href",aAction:"action",aTargetMod:"ice-target-module"}),Q.extend(m,{history:{entity:t.history,replace:function(t,e,n){this.entity.replaceState(t,e,n)},push:function(t,e,n){this.entity.pushState(t,e,n)},getOriginalState:function(){return this.entity.state},state:{},signature:null,setState:function(t,e,n){this.state[t]=e,n===!0||(this.signature=t)},getState:function(t){return this.state[t]}},moduleRecord:{},setModuleRecord:function(t,e,n){if(m.moduleRecord[t]=e,n===!0){var r={};Q.foreach(m.moduleRecord,function(t,e){"object"===Q.type(Q.s("*[ice-module="+e+"]"))&&(r[e]=t)}),m.moduleRecord=r}},getModuleRecord:function(t){return m.moduleRecord[t]},getFormatModuleRecord:function(){var t=[];return Q.foreach(m.moduleRecord,function(e,n){k.call(t,n+(T.params.moduleSeparator||"")+e)}),"/"+O.call(t,"/")},click:function(t){var e=this.getAttribute(m.aTargetMod),n=this.getAttribute(m.aHref),r=Q.s("*["+m.aModule+"="+e+"]");if(t.preventDefault(),"object"!==Q.type(r))throw A("module","找不到"+e+"模块");c(r)===n||m(n,r,null,T.params.header[n],null,null,null,null,null,null,!0)}});g.prototype={constructor:g,putWaiting:function(t){this.waiting.push(t)},dropWaiting:function(t){var e=this.waiting.indexOf(t);return e!==-1&&this.waiting.splice(e,1),this.waiting.length},putLoad:function(t,e){this.load[t]=e},getLoad:function(t){return this.load[t]}},g.suffix=".js",g.moduleName="data-moduleName",g.scriptFlag="module-loading",g.loaderID="loader-ID",g.topModuleName="*",g.loaders={},g.create=function(t,e,n){return g.loaders[t]=new g(e,n),g.loaders[t]},g.getCurrentModule=function(){try{____a.____b()}catch(t){if(t.stack){var e=/\?m=(\S+)&guid=([\d]+):?/.exec(t.stack);return{name:e[1],guid:e[2]}}}},g.inject=function(t,e){var n,r,o=[b];return Q.foreach(t.deps,function(t){(n=tt.componentFactory(t,G))?o.push(n):(n=g.inject(e.getLoad(t),e),tt.componentCreater(t,n,V),o.push(n))}),t.type===X||t.type===B?r=function(){t.factory.apply(null,o)}:t.type===G?r=t.factory.apply(null,o):t.type===J,r},g.factoryInvoke=function(t,e){if(e===X)if(W===_)tt.setPageFactory(t);else{if(W!==K)throw C("error","页面状态错误(page)");t&&t(),W=$,tt.queueInvoke()}else if(e===B)if(W===K)tt.addUnexecutedModule(t);else{if(W!==$)throw C("error","页面状态错误(module)");t&&t()}},g.onScriptLoaded=function(t){var e=t.target.getAttribute(g.loaderID),n=g.loaders[e];if(0===n.dropWaiting(t.target.getAttribute(g.moduleName))){var r=g.inject(n.getLoad(g.topModuleName),n);g.factoryInvoke(r,n.getLoad(g.topModuleName).type),delete g.loaders[e]}},v.prototype={constructor:v},Q.extend(b,{refreshModule:function(t,e,n,r){"object"===Q.type(t)&&1===arguments.length},submit:function(t,e,n,r){}});var et=["@","$","^","*","|",":","~","!"];Q.extend(I,{config:T}),function(){var t;if(t=Q.s("script[config]").getAttribute("config")){var e=F.createElement("script");e.src=t,Q.appendScript(e,function(){W=U,Y.emit("parsed")})}else T({}),W=U}(),function(e){function n(){Y.remove(F,"DOMContentLoaded",n),Y.remove(t,"load",n),e()}"complete"===F.readyState?e():(Y.on(F,"DOMContentLoaded",n),Y.on(t,"load",n))}(function(){function e(){w(),W=K,Y.emit("page")}W===U?e():Y.on("parse",e,!1,!0),l(P.call(t.location.pathname,"/"),function(t,e){m.setModuleRecord(t,e)}),m.history.setState(t.location.pathname,null),W=K,tt.queueInvoke()}),Q.extend(I,{page:function(t,n){if(0===arguments.length)throw M("function ice.page","至少需要传入模块主函数参数");t&&!n&&(n=t,t=[]);var r=Q.type(t),o=Q.type(n);if(t!==e&&null!==t&&"array"!==r)throw M("function ice.page:dependence","方法第一个参数类型为Array，也可不传入第一个参数或传入null，方法将自动忽略此参数");if("function"!==o)throw M("function ice.page:factory","至少需要传入模块主函数参数，而不是其他类型参数");Y.on("page",function(){x(g.topModuleName,t,n,X)})},module:function(t,n){if(0===arguments.length)throw M("function ice.module","至少需要传入模块主函数参数");t&&!n&&(n=t,t=[]);var r=Q.type(t),o=Q.type(n);if(t!==e&&null!==t&&"array"!==r)throw M("function ice.module:dependence","方法第一个参数类型为Array，也可不传入第一个参数或传入null，方法将自动忽略此参数");if("function"!==o)throw M("function ice.module:factory","至少需要传入模块主函数参数，而不是其他类型参数");x(g.topModuleName,t,n,B)},control:function(t){return w(t,!0)}}),Q.extend(t,{plugin:function(t,n){if(0===arguments.length)throw M("function ice.plugin","至少需要传入模块主函数参数");t&&!n&&(n=t,t=[]);var r=Q.type(t),o=Q.type(n);if(t!==e&&null!==t&&"array"!==r)throw M("function ice.plugin:dependence","方法第一个参数类型为Array，也可不传入第一个参数或传入null，方法将自动忽略此参数");if("function"!==o)throw M("function ice.plugin:factory","至少需要传入模块主函数参数，而不是其他类型参数");x(g.getCurrentModule()||"",t,n,G)},driver:function(t,n){if(0===arguments.length)throw M("function ice.driver","至少需要传入模块主函数参数");t&&!n&&(n=t,t=[]);var r=Q.type(t),o=Q.type(n);if(t!==e&&null!==t&&"array"!==r)throw M("function ice.driver:dependence","方法第一个参数类型为Array，也可不传入第一个参数或传入null，方法将自动忽略此参数");if("function"!==o)throw M("function ice.driver:factory","至少需要传入模块主函数参数，而不是其他类型参数");x(g.topModuleName,t,n,J)}})}(window);