/*
 ice V0.1.0
 @author:JOU<huzhen555@qq.com>
 License:MIT
*/
!function(e,t){"use strict";function n(e){return function(t,n){var o="[ice:"+(e?e+"-":"")+t+"] "+n;return new Error(o)}}function o(e){return null!==e?e instanceof Array?"array":typeof e:"null"}function r(e,t,n){var r,a=o(e),i=o(t),c=0;if("array"===a&&n===!0)for(;c<e.length&&(r=t(e[c],c,e),r!==!1);c++);else{if("object"!==a&&n===!0)throw M("target","第一个参数类型必须为array或object");for(c in e)if(r=t(e[c],c,e),r===!1)break}if("function"!==i)throw M("callback","第二个参数类型必须为function")}function a(e,t){if("array"===o(e)){for(var n=e.length;--n>=0;)if(e[n]===t)return!0;return!1}throw M("function inArray:array","第一个参数必须为数组")}function i(){var e,n=arguments[0],i=o(n),c=L.call(arguments,1);if("array"!==i&&"object"!==i&&"function"!==i)throw M(i,"合并父体类型需为Array、Object或Function");return r(c,function(c){e=o(c),"array"===i?"array"===e||"object"===e?r(c,function(e){a(n,e)||n.push(e)}):null!==e&&e!==t&&n.push(c):"object"!==i&&"function"!==i||"object"===e&&r(c,function(e,t){n[t]=e})}),n}function c(e,t){t=!!t;var n=/\./g,o=/\//g,r=".",a="/";return t?e.replace(o,r):e.replace(n,a)}function u(e,t){e.currentPath=t}function l(e){return e.currentPath||""}function s(e,t){var n,o=[].concat(e);if("/"===m.params.moduleSeparator)for(var r=0;r<o.length;)""!==o[r]?(t(o[r],o[r+1]||""),r+=2):r++;else Q.foreach(o,function(e){""!==e&&(n=e.split(m.params.moduleSeparator),t(n[0],n[1]))})}function p(e){function t(){u===a&&(u=i,o=arguments,Q.foreach(l,function(e){e.onFulfilled&&e.onFulfilled.apply(null,o)}))}function n(e){u===a&&(u=c,r=e,Q.foreach(l,function(e){e.onRejected&&e.onRejected(r)}))}if("function"!==Q.type(e))throw M("function Promise","构造函数需传入一个函数参数");var o,r,a=0,i=1,c=2,u=a,l=[];this._isThenable=function(e){var t=Q.type(e);if(e&&("object"===t||"function"===t)){var n=e.then;if("function"===Q.type(n))return!0}return!1},this.handle=function(e){u===a?l.push(e):u===i&&"function"===Q.type(e.onFulfilled)?e.onFulfilled.apply(null,o):u===c&&"function"===Q.type(e.onRejected)&&e.onRejected(r)},e(t,n)}function f(){}function d(){}function h(t,n,o,r,a,i){var c,s,p,f,d,y,g,v,b,M,x=":m",T=":v",j=[];if("string"===Q.type(t)?p=[{url:t,entity:n,title:o,isCache:r}]:(p=t,a=n,i=o),Q.foreach(p,function(e){c=Q.type(e.title),s=e.entity.getAttribute(h.aModule),y=s+"_"+e.url,g=m.params.urlRule,e.isCache===!0&&(f=ee.getRedirect(y))?Q.html(e.entity,f):(g=Q.replaceAll(g||"",x,s),g=Q.replaceAll(g||"",T,e.url),v=g.indexOf("/"),g="false"!==e.entity.getAttribute(h.aBase)&&m.params.base.url.length>0?m.params.base.url+(0===v?P.call(g,1):g):0===v?g:"/"+g,Z.get(g).done(function(t){try{t=JSON.parse(t),d=t[m.params.htmlKey]}catch(n){d=t}Q.html(e.entity,d),e.isCache===!0&&ee.addRedirect(y,d),e.title="string"===c?e.title:"function"===c?e.title(t[m.params.codeKey]||null)||null:null}),"string"===Q.type(e.title)&&(b=H.title,H.title=e.title),M=l(e.entity),u(e.entity,e.url),E.call(j,{url:M,moduleName:s,cache:e.isCache,title:b}),a===!0&&h.setModuleRecord(s,e.url,!0))}),a===!0){if(!h.history.entity.pushState)throw w("History API","浏览器不支持HTML5 History API");h.history.setState(h.history.signature,j,!0),i===!0||h.history.push(null,_module.title,h.getFormatModuleRecord()),h.history.setState(e.location.pathname,null)}}function y(){}function g(){}function m(e){if("object"!==Q.type(e))throw T("params","配置参数为参数对象");var n,o={base:{url:"",plugin:"",driver:"",lang:""},stateMark:oe[0],redirectCache:!0,codeKey:"code",htmlKey:"html",moduleSeparator:"-",urlRule:":m/:v.html",header:{}};Q.isEmpty(e)||(e.base!==t&&(e.base.url!==t&&(n=Q.type(e.base.url),e.base.url="string"===n?e.base.url:"function"===n?e.base.url():"",e.base.url="/"===e.base.url.substr(-1,1)?e.base.url:e.base.url+"/"),e.base.plugin!==t&&(n=Q.type(e.base.plugin),e.base.plugin="string"===n?e.base.plugin:"function"===n?e.base.plugin():"",e.base.plugin="/"===e.base.plugin.substr(-1,1)?e.base.plugin:e.base.plugin+"/"),e.base.driver!==t&&(n=Q.type(e.base.driver),e.base.driver="string"===n?e.base.driver:"function"===n?e.base.driver():"",e.base.driver="/"===e.base.driver.substr(-1,1)?e.base.driver:e.base.driver+"/")),e.base!==t&&e.base.lang!==t&&(n=Q.type(e.base.lang),e.base.lang="string"===n?e.base.lang:"function"===n?e.base.lang():"",e.base.lang="/"===e.base.lang.substr(-1,1)?e.base.lang:e.base.lang+"/"),e.stateMark=oe.indexOf(e.stateMark)===-1?oe[0]:e.stateMark,e.redirectCache=e.redirectCache!==!1),e.base=Q.extend(o.base,e.base),Q.extend(m,{params:Q.extend(o,e)})}function v(n,o){if(o===!0){if(n===t||null===n||1!==n.nodeType&&11!==n.nodeType)throw M("function control:node","control方法要求传入一个有效的node对象或DocumentFragment对象")}else o!==t||n!==t&&null!==n||(n=Q.s("body"));var r,a,i,c,l,p,f,d=[],y={};1===n.nodeType&&null!==n.getAttribute(h.aModule)&&d.push(n),d=d.concat(Q.S("*["+h.aModule+"]",n)),Q.foreach(d,function(e){return 1===e.nodeType&&void((r=e.getAttribute(h.aSrc))&&(a=e.getAttribute(h.aCache),r=h.getModuleRecord(e.getAttribute(h.aModule))||r,u(e,r),h(r,e,null,"true"===a||m.params.redirectCache===!0&&"false"!==a)))}),Q.foreach(L.call(Q.S("*["+h.aHref+"]")),function(e){"LINK"!==e.nodeName&&e.getAttribute(h.aTargetMod)&&Y.on(e,"click",h.click)}),Y.on(e,"popstate",function(t){i=h.history.getState(e.location.pathname),c={},l={},y={},p=[],"array"===Q.type(i)&&i.length>0?(1===i.length?E.call(p,{url:i[0].url,entity:Q.s("*["+h.aModule+"="+i[0].moduleName+"]"),title:i[0].title,isCache:i[0].cache}):Q.foreach(i,function(e){E.call(p,{url:e.url,entity:Q.s("*["+h.aModule+"="+e.moduleName+"]"),title:e.title,isCache:e.cache})}),h(p,!0,!0)):(s(R.call(h.history.signature,"/"),function(e,t){c[e]=t}),s(R.call(e.location.pathname,"/"),function(e,t){l[e]=t}),Q.foreach(l,function(e,t){c[t]!==e&&(y[t]=e)}),Q.foreach(c,function(e,t){l[t]!==e&&(y[t]=null)}),Q.foreach(y,function(e,t){f=Q.s("*["+h.aModule+"="+t+"]"),e=null===e?f.getAttribute(h.aSrc):e,h(e,f,m.params.header[e],"false"!==f.getAttribute(h.aCache)&&m.params.redirectCache,!0,!0)}))})}function b(e,n,o,r){if(!n&&!o)throw M("function module","至少需要传入模块主函数参数");n&&!o&&(o=n,n=t);var a=Q.type(n),i=Q.type(o);if(n!==t&&null!==n&&"array"!==a)throw M("function module:dependence","方法第一个参数类型为Array，也可不传入第一个参数或传入null，方法将自动忽略此参数");if("function"!==i)throw M("function module:factory","至少需要传入模块主函数参数，而不是其他类型参数");var u,l=/^function\s*\((.*)\)\s*/,s=l.exec(o.toString())[1].split(",");Q.foreach(s,function(e,t,n){n[t]=Q.trim(e)}),n="array"===Q.type(n)?n.slice(0,s.length-1):n,ne.putLoadModules(e,{type:r,deps:n,factory:o,args:s}),"array"===Q.type(n)&&Q.foreach(n,function(e){e=c(e,!0),ee.componentFactory(e,J)||(ne.putWaitingModuleName(e),ne.putLoadingModuleName(e)),u=H.createElement("script"),u.src=m.params.base.plugin+e+ne.suffix,u.setAttribute(ne.moduleName,c(e)),Q.appendScript(u,ne.onScriptLoaded)})}var w=n("env"),M=n("arg"),x=n("request"),T=n("config"),j=n("runtime"),C=n("module");if("undefined"==typeof e||"object"!=typeof e.document)throw w("browser","ice只能在浏览器环境中运行...");var S=[],A="",L=S.slice,N=S.splice,E=S.push,O=S.join,R=(S.concat,A.toUpperCase,A.toLowerCase,A.split),P=A.substr,X=A.replace,H=(Object.prototype.toString,Object.prototype.hasOwnProperty,Object.prototype.isPrototypeOf,e.document),F=e.ice||(e.ice={}),k=/^(?:TEXT|JSON|SCRIPT)$/,q={method:"GET",url:"",data:"",async:!0,cache:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",type:"TEXT"},I=(function(e){var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.* rv:([\w.]+)|)/.exec(e)||[],n=/(mac)/.exec(e)||/(windows)/.exec(e)||/(ipad)/.exec(e)||/(iphone)/.exec(e)||/(android)/.exec(e)||[],o={};return o[t[1]||""]=!0,o.version=t[2]||"0",o.platform=n[0]||"",o}(e.navigator.userAgent.toLowerCase()),["Microsoft.XMLHTTP","MSXML.XMLHTTP","Msxml2.XMLHTTP.7.0","Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.5.0","Msxml2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP"]),U=0,D=1,K=2,_=3,$=U,B=1,W=2,J=3,G=4,z="BUILT_IN",V="EXTERNAL",Q=i({},{extend:i,type:o,foreach:r,inArray:a,hasKey:function(e,t){if("object"===Q.type(e)){var n=!1;return Q.foreach(e,function(e,o){if(o===t)return n=e,!1}),n}throw M("function hasKey:object","检测对象必须为object类型")},isEmpty:function(e){var t=!0,n=Q.type(e);if("array"!==n&&"object"!==n)throw M("object","参数类型必须为array或object");return Q.foreach(e,function(){return t=!1,!1}),t},trim:function(e){if("string"!==Q.type(e))throw M("arg-type","参数类型必须为string");return e.replace(/(^\s*)|(\s*$)/g,"")},s:function(e,t){return(t||H).querySelector(e)},S:function(e,t){return L.call((t||H).querySelectorAll(e))},getAll:function(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return e.nodeName===t.toUpperCase()?L.call(n).concat([e]):L.call(n)},appendScript:function(e,t){var n=H.createElement("script");n.type="text/javascript",Q.foreach(e.attributes,function(e){2===e.nodeType&&n.setAttribute(e.nodeName,e.nodeValue)}),e.src?(n.async=!0,Y.on(n,"load readystatechange",function(e){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.raeadyState||t&&t(e),n.parentNode.removeChild(n)}),Y.on(n,"error",function(){n.parentNode.removeChild(n)}),H.head.appendChild(n)):e.text&&(n.text=e.text||"",H.head.appendChild(n).parentNode.removeChild(n))},scriptEval:function(e){var t=Q.type(e);if("string"===t){var n=H.createElement("script");n.type="text/javascript",n.text=e,Q.appendScript(n)}else if("object"===t&&1===e.nodeType&&"script"===e.nodeName.toLowerCase())Q.appendScript(e);else{if("array"!==t)throw M("arg","参数必须为javascript代码片段、script标签或script标签数组");var o=e.slice(0);Q.foreach(e,function(e){return N.call(o,0,1),e.src?(Q.appendScript(e,function(){o.length>0&&Q.scriptEval(o)}),!1):void Q.appendScript(e)})}},clear:function(e){if(1!==e.nodeType)throw M("context","元素类型必须是dom节点");return e.textContent="",e},append:function(e,t){var n,o,r,a=/<|&#?\w+;/,i=Q.type(t),c=0,u=[],l=[];if(1===e.nodeType){if("string"!==i||a.test(t))if("object"===i)t.nodeType&&u.push(t);else{for(n=H.createDocumentFragment(),o=n.appendChild(H.createElement("div")),o.innerHTML=t;c<o.childNodes.length;c++)u.push(o.childNodes[c]);o.textContent=""}else u.push(H.createTextNode(t));return n.textContent="",Q.foreach(u,function(t){if(e.appendChild(t),1===t.nodeType)for(o=Q.getAll(t,"script"),c=0;r=o[c++];)l.push(r)}),Q.isEmpty(l)||Q.scriptEval(l),e}throw M("context","context必须为DOM节点")},html:function(e,t){return e=Q.clear(e),e=Q.append(e,t)},replaceAll:function(e,t,n){if(3!==arguments.length)throw M("function:replaceAll","必须传入被替换字符串、查找替换的字符串和替换的字符串三个参数");if("string"!==Q.type(e)||"string"!==Q.type(t)||"string"!==Q.type(n))throw M("function:replaceAll","函数所有参数类型都必须为string");return t=t.split(""),Q.foreach(t,function(e,t,n){n[t]=["$","(",")","*","+",".","[","]","?","\\","^","{","}","|"].indexOf(e)!==-1?"\\"+e:e}),e.replace(new RegExp(t.join(""),"gm"),n)},isWindow:function(e){try{return"object"===Q.type(e)&&!!e.eval&&!!e.setInterval&&e.window===e.window.window}catch(t){return!1}}}),Y=function(){function e(e){o.emit(e.currentTarget||e.target,e.type)}function n(e,t,n,o){function u(e,t,n,o,r){if(a=Q.type(n),i=Q.type(o),"string"===a){if("function"===i){if(r){if(c=e[n].length>0){for(;--c>-1;)e[n][c]&&e[n][c].guid===o.guid&&N.call(e[n],c,1);0===e[n].length&&delete e[n]}}else e[n]||Object.defineProperty(e,n,{value:[],configurable:!0,enumerable:!0,writable:!0}),e[n].push(o);return e}return e[n]}return e}if(e){if(e.valueOf.override!==!0){if(!n||o)return t?[]:{};var s={};r=e.valueOf,Object.defineProperty(e,"valueOf",{value:function(){return arguments.length>0?u.apply(null,[s].concat(L.call(arguments))):r.call(e)}}),e.valueOf.override=!0}return e.valueOf(e,t,n,o)}u(l,null,t,n,o)}var o,r,a,i,c,u,l={},s=1,p=/\S+/g,f={DOMContentLoaded:function(){return!!H.addEventListener}};return o={support:function(e,t){t=t||H.createElement("div");var n;return"function"===Q.type(f[e])?n=f[e]():(e="on"+e,n=e in t,!n&&t.setAttribute&&(t.setAttribute(e,""),n="function"===Q.type(t[e]))),n},on:function(r,a,i,c,u){if(Q.isWindow(r)||"object"===Q.type(r)&&r.nodeType||(u=c,c=i,i=a,a=r,r=t),r&&(3===r.nodeType||8===r.nodeType))throw M("function event.on:elem","elem参数不能为文本节点或注释节点");if("string"!==Q.type(a))throw M("function event.on:types","types参数类型必须为string");if("function"!==Q.type(i))throw M("function event.on:listener","listener参数类型必须为function");i.guid||(i.guid=s++),u===!0&&(i.once=!0,i.useCapture=c),X.call(a||"",p,function(t){n(r,t,i),r&&o.support(t,r)&&r.addEventListener&&r.addEventListener(t,e,!!c)})},remove:function(r,a,i,c){if(Q.isWindow(r)||"object"===Q.type(r)&&r.nodeType||(c=i,i=a,a=r,r=t),r.nodeType&&(3===r.nodeType||8===r.nodeType))throw M("function event.on:elem","elem参数不能为文本节点或注释节点");if("string"!==Q.type(a))throw M("function event.remove:types","types参数类型必须为string");if("function"!==Q.type(i))throw M("function event.remove:listener","listener参数类型必须为function");Q.isEmpty(n(r))||X.call(a||"",p,function(t){Q.isEmpty(n(r,t,i,!0))&&r&&o.support(t,r)&&r.removeEventListener&&r.removeEventListener(t,e,!!c)})},emit:function(e,r){if("string"===Q.type(e)&&(r=e,e=t),e&&(3===e.nodeType||8===e.nodeType))throw M("function event.emit:elem","elem参数不能为文本节点或注释节点");if("string"!==Q.type(r))throw M("function event.emit:types","types参数类型必须为string");X.call(r||"",p,function(t){u=n(e,t),"array"===Q.type(u)&&u.length>0&&Q.foreach(u,function(n){"function"===Q.type(n)&&n.call(e),n.once===!0&&o.remove(e,t,n,n.useCapture)})})}}}();p.prototype={constructor:p,then:function(e,t){var n=this;return new p(function(o,r){n.handle({onFulfilled:function(){var t="function"===Q.type(e)&&e.apply(null,arguments)||arguments;n._isThenable(t)&&t.then(function(){o()},function(e){r(e)})},onRejected:function(e){var n="function"===Q.type(t)&&t(e)||e;r(n)}})})},done:function(e){return this.handle({onFulfilled:e}),this},fail:function(e){return this.handle({onRejected:e}),this},always:function(e){this.handle({onFulfilled:e,onRejected:e})}},p.when=function(){};var Z=Q.extend({},{request:function(t){return new p(function(n,o){var r,a,i,c=/%20/g,u=/#.*$/,l=/([?&])_=[^&]*/,s=/\?/,p=/^(?:GET|HEAD)$/;if(t.resolve=n,t.reject=o,t=Q.extend({},q,t||{}),t.hasContent=!p.test(t.method=t.method.toUpperCase()),t.type=k.test(t.type=(t.type||"").toUpperCase())?t.type:"TEXT","object"===Q.type(t.data)){var f=[];Q.foreach(t.data,function(e,t){f.push(t+"="+e)}),t.data=f.join("&")}if(t.hasContent?t.data&&"string"===Q.type(t.data)&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&(t.data=t.data.replace(c,"+")):(r=t.url.replace(u,""),a=t.url.slice(r.length),r+=t.data?(s.test(r)?"&":"?")+t.data:"",r=r.replace(l,""),r+=t.cache===!1?(s.test(r)?"&":"?")+"_="+Date.now():"",t.url=r+(a||"")),e.XMLHttpRequest)i=new XMLHttpRequest;else{if(!e.ActiveXObject)throw x("create","创建XHR失败");Q.foreach(I,function(t){try{i=new e.ActiveXObject(t)}catch(n){}})}i.open(t.method,t.url,t.async),t.hasContent&&t.data&&t.contentType&&i.setRequestHeader("Content-Type",t.contentType),i.onload=function(){if((i.status>=200&&i.status<300||304===i.status)&&t.resolve){var e,n={TEXT:function(){e=i.responseText},JSON:function(){try{e=JSON.parse(i.responseText)}catch(t){e=""}},SCRIPT:function(){e=i.responseText,Q.scriptEval(e)}};n[t.type](),t.success&&t.success(e)||t.resolve(e)}else t.reject&&(t.error&&t.error(i.responseText)||t.reject(i.responseText))},i.onerror=function(e){t.error&&t.error(e)||t.reject(e)},i.onabort=function(){};try{i.send(t.hasContent&&t.data||null)}catch(d){throw x("send",d)}})},get:function(e,n,o,r){"string"===Q.type(o)&&r===t&&(r=o,o=t),"function"===Q.type(n)?(o=n,n=t):k.test((n||"").toUpperCase())&&(r=n,n=t);var a={url:e};return a.args=n?n:t,a.success=o?o:t,a.type=r?r:t,Z.request(a)},post:function(e,n,o,r){"string"===Q.type(o)&&r===t&&(r=o,o=t),"function"===Q.type(n)?(o=n,n=t):k.test((n||"").toUpperCase.call())&&(r=n,n=t);var a={url:e,method:"POST"};return a.data=n?n:t,a.success=o?o:t,a.type=r?r:t,Z.request(a)}}),ee=function(){function e(e,t){Q.foreach(e,function(e,n){if(o[t].hasOwnProperty(n))throw C("plugin",n+"插件已存在");o[t][n]=e})}function n(e){Q.foreach(e,function(e,t){if(r.hasOwnProperty.call(t))throw C("driver",t+"元素驱动器已存在");r[t]=e})}var o={};o[z]={},o[V]={};var r={},a={},i={},c={page:null,module:[]};return{componentCreater:function(o,r,a){var i,c=Q.type(o);return"object"===c?(a=r,r=o,o=t):(i=r,r={},r[o]=i),a===z||a===V?e(r,a):a===G&&n(r),i||r},componentFactory:function(e,n){return n===J||n===t?o[z][e]||o[V][e]:n===G?r[e]:null},addRedirect:function(e,t){if(a.hasOwnProperty(e))throw C("module",e+"页面模块已存在");a[e]=t},getRedirect:function(e){return a[e]},addModule:function(e,t){if(i.hasOwnProperty(e))throw C("module",e+"模块已存在");i[e]=t},getModule:function(e){return i[e]},setPageFactory:function(e){"function"===Q.type(e)&&(c.page=e)},addUnexecutedModule:function(e){"function"===Q.type(e)&&E.call(c.module,e)},queueInvoke:function(){$===K&&"function"===Q.type(c.page)?c.page():$===_&&c.module.length>0&&Q.foreach(c.module,function(e){"function"===Q.type(e)&&e()})}}}();Q.extend(h,{aModule:"ice-module",aSrc:"ice-src",aCache:"ice-cache",aBase:"ice-base",aLoading:"ice-loading",aFinish:"ice-finish",aHref:"href",aAction:"action",aTargetMod:"ice-target-module"}),Q.extend(h,{history:{entity:e.history,replace:function(e,t,n){this.entity.replaceState(e,t,n)},push:function(e,t,n){this.entity.pushState(e,t,n)},getOriginalState:function(){return this.entity.state},state:{},signature:null,setState:function(e,t,n){this.state[e]=t,n===!0||(this.signature=e)},getState:function(e){return this.state[e]}},moduleRecord:{},setModuleRecord:function(e,t,n){if(h.moduleRecord[e]=t,n===!0){var o={};Q.foreach(h.moduleRecord,function(e,t){"object"===Q.type(Q.s("*[ice-module="+t+"]"))&&(o[t]=e)}),h.moduleRecord=o}},getModuleRecord:function(e){return h.moduleRecord[e]},getFormatModuleRecord:function(){var e=[];return Q.foreach(h.moduleRecord,function(t,n){E.call(e,n+(m.params.moduleSeparator||"")+t)}),"/"+O.call(e,"/")},click:function(e){var t=this.getAttribute(h.aTargetMod),n=this.getAttribute(h.aHref),o=this.getAttribute(h.aCache),r=Q.s("*["+h.aModule+"="+t+"]");if(e.preventDefault(),"object"!==Q.type(r))throw C("module","找不到"+t+"模块");l(r)===n||h(n,r,m.params.header[n],"true"===o||m.params.redirectCache===!0&&"false"!==o,!0)}});var te={},ne={suffix:".js",moduleName:"data-moduleName",topModuleName:"*",context:{loadModules:{},waiting:[],loadingModules:{pointer:0,names:[]}},init:function(){this.context.loadModules={},this.context.waiting=[],this.context.loadingModules.pointer=0,this.context.loadingModules.names=[]},putLoadModules:function(e,t){this.context.loadModules[e]=t},putWaitingModuleName:function(e){"array"===Q.type(this.context.waiting)&&this.context.waiting.push(e)},putLoadingModuleName:function(e){"array"===Q.type(this.context.loadingModules.names)&&this.context.loadingModules.names.push(e)},getLoadingModuleName:function(){return!Q.isEmpty(this.context.loadingModules.names)&&this.context.loadingModules.pointer>=0&&this.context.loadingModules.names[this.context.loadingModules.pointer++]},inject:function(e){var t,n,o=[y],r=ne;return"array"===Q.type(e.deps)&&Q.foreach(e.deps,function(e){(t=ee.componentFactory(e,J))?o.push(t):(t=r.inject(r.context.loadModules[e]),ee.componentCreater(e,t,V),o.push(t))}),e.type===B||e.type===W?n=function(){e.factory.apply(null,o)}:e.type===J?n=e.factory.apply(null,o):e.type===G,n},onScriptLoaded:function(e){var t,n=ne,o=n.context.waiting.indexOf(e.target.getAttribute(n.moduleName));o!==-1&&n.context.waiting.splice(o,1),0===n.context.waiting.length&&(t=n.inject(n.context.loadModules[n.topModuleName]),n.factoryInvoke(t,n.context.loadModules[n.topModuleName].type))},factoryInvoke:function(e,t){if(t===B)if($===U)ee.setPageFactory(e);else{if($!==K)throw j("error","页面状态错误(page)");e&&e(),$=_,ee.queueInvoke()}else if(t===W)if($===K)ee.addUnexecutedModule(e);else{if($!==_)throw j("error","页面状态错误(module)");e&&e()}}};ee.componentCreater({event:Y,Promise:p,animation:f,language:d,util:Q,http:Z},z),Q.extend(y,{refreshModule:g});var oe=["@","$","^","*","|",":","~","!"];Q.extend(F,{config:m}),function(){var e;if(e=Q.s("script[config]").getAttribute("config")){var t=H.createElement("script");t.src=e,Q.appendScript(t,function(){$=D,Y.emit("parsed")})}else m({}),$=D}(),function(t){function n(){Y.remove(H,"DOMContentLoaded",n),Y.remove(e,"load",n),t()}"complete"===H.readyState?t():(Y.on(H,"DOMContentLoaded",n),Y.on(e,"load",n))}(function(){function t(){v(),Q.isEmpty(te)&&(Y.emit("page"),$=K)}$===D?t():Y.on("parse",t,!1,!0),s(R.call(e.location.pathname,"/"),function(e,t){h.setModuleRecord(e,t)}),h.history.setState(e.location.pathname,null),$=K,ee.queueInvoke()}),Q.extend(F,{page:function(e,t){return ne.init(),b(ne.topModuleName,e,t,B),this},module:function(e,t){return ne.init(),b(ne.topModuleName,e,t,W),this},control:function(e){v(e,!0)}}),Q.extend(e,{plugin:function(e,t){b(ne.getLoadingModuleName()||"",e,t,J)},driver:function(e,t){b(ne.topModuleName,e,t,G)}})}(window);